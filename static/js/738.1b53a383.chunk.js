"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[738],{9110:(e,t,r)=>{r.d(t,{Z:()=>i});r(7313);var n=r(1783),a=r(3209),s=r(6417);class o extends n.Z{constructor(e){super(e,"Save Report As"),this.nameChanged=e=>this.setState({newQueryName:e}),this.copyChanged=e=>this.setState({copyQuery:e}),this.done=()=>{const{newQueryName:e,copyQuery:t}=this.state;this.props.onChange(e,t)},this.style={width:"350px"},this.state={showDialog:!0,newQueryName:e.queryName||"",copyQuery:!1}}getFooter(){const{state:{newQueryName:e}}=this;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.zx,{text:!0,type:"secondary",label:"Cancel",onClick:this.onHide}),(0,s.jsx)(a.zx,{type:"primary",icon:"fa fa-save",label:"Save",disabled:!e||e.length<3,onClick:this.done})]})}render(){const{props:{allowCopy:e},state:{newQueryName:t,copyQuery:r}}=this;return super.renderBase((0,s.jsxs)("div",{className:"pad-15",children:[(0,s.jsx)("label",{children:"Report Name"}),(0,s.jsx)("div",{children:(0,s.jsx)(a.zC,{value:t,onChange:this.nameChanged,style:{width:"100%"}})}),e&&(0,s.jsx)("div",{children:(0,s.jsx)(a.XZ,{checked:r,onChange:this.copyChanged,label:"Save as new report"})})]}))}}const i=o},9738:(e,t,r)=>{r.r(t),r.d(t,{default:()=>pr});var n={};r.r(n),r.d(n,{as_date:()=>De,avg:()=>_e,currentUser:()=>$e,date_diff:()=>Ue,first:()=>ze,last:()=>Ve,max:()=>Be,min:()=>qe,now:()=>Me,parameters:()=>Ie,sum:()=>Oe,today:()=>Ge,todayEOD:()=>Le});var a=r(7313),s=r(8467),o=r(8244),i=r(3209),l=r(9642),c=r(2328),u=r(6123),d=r.n(u),p=r(1485),m=r(2362),f=r(7154),h=r(551),y=r(6310),g=r(6444),v=(r(7340),r(6417));const x=function(e){const{title:t,iconClass:r,hideRefresh:n,gadgetHint:s,hideMenu:o,isLoading:u,customActions:m,onRefresh:f,settings:g}=e,x=a.useRef({}),w=!1!==e.isGadget,j=g||{fullWidth:!1,fullHeight:!1},[k,N]=(0,a.useState)(j.fullWidth||!1),[S,C]=(0,a.useState)(j.fullHeight||!1),[T,A]=(0,a.useState)(!1),F=a.useId();(0,a.useEffect)((()=>{g&&(N(g.fullWidth),C(g.fullHeight))}),[g]);const{$analytics:E}=(0,y.f3)("AnalyticsService"),P=()=>{A(!T),T?document.body.classList.remove("fs-layout"):document.body.classList.add("fs-layout")},$=(t,r)=>{e.onAction&&e.onAction({type:t,data:r},e.model,e.index)};x.current.props=e,x.current.isGadget=w,x.current.fullWidth=k,x.current.fullHeight=S,x.current.isFullScreen=T,x.current.$analytics=E,x.current.setSizeOptions=(e,t)=>{j.fullWidth=e,j.fullHeight=t,N(e),C(t),I()},x.current.toggleFullScreen=P,x.current.performAction=$;const I=()=>{$(h.X.SettingsChanged,j)},R=e=>(0,p.pT)(e,b(x.current)),D=a.useCallback((e=>(0,p.pT)(e,b(x.current))),[]),{children:G,tabLayout:L,gadgetType:M}=e;if(L)return(0,v.jsx)(v.Fragment,{children:G});const U=k||!w,O=S||!w,_=d()("gadget",e.className,{docked:!w,"full-width":U&&!T,"full-height":O&&!T,"half-width":!U&&!T,"half-height":!O&&!T,"full-screen":T});return(0,v.jsxs)("div",{ref:t=>{x.current.rootEl=t;const{dropProps:{dropConnector:r}={}}=e;r&&r(t)},className:_,"data-test-id":M,children:[u&&(0,v.jsx)(i.aN,{}),(0,v.jsx)(l.Panel,{header:(()=>{const{subTitle:a,draggableHandle:l}=e,d="gadget-header"+(l?" movable":"");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{ref:l,className:d,onContextMenu:w?R:null,onDoubleClick:P,children:[(0,v.jsx)("i",{className:`fa ${r}`})," ",t," ",a&&(0,v.jsxs)("span",{children:[" - ",a]}),(0,v.jsxs)("div",{className:"float-end",children:[s?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.u,{target:`.icon-hint-${F}`,children:s}),(0,v.jsx)("i",{className:`fa fa-info-circle icon-hint icon-hint-${F}`,"data-pr-position":"bottom"})]}):null,m,!n&&(0,v.jsx)(i.zx,{text:!0,icon:"fa fa-refresh",disabled:u,onClick:p||f,title:"Refresh data"}),!o&&(0,v.jsx)(i.zx,{text:!0,icon:"fa fa-wrench",onClick:D})]})]}),(0,v.jsx)("div",{className:"clearfix"})]});var p})(),children:G})]})};function b(e){const{$analytics:t,performAction:r,isGadget:n,isFullScreen:a,fullWidth:s,fullHeight:o,rootEl:i,setSizeOptions:l,toggleFullScreen:c,props:{title:u,hideExport:d,hideCSVExport:p,hideXLSXExport:m,hidePDFExport:y}}=e,v=n?[{separator:!0},{label:"Full width",icon:`fa fa-${s?"check-":""}circle fs-16 margin-r-5`,command:()=>l(!s,o)},{label:"Full height",icon:`fa fa-${o?"check-":""}circle fs-16 margin-r-5`,command:()=>l(s,!o)},{separator:!0},{label:"Remove",icon:"fa fa-remove",command:()=>{t.trackEvent("Gadget removed",g.Jk.GadgetActions,u),r(h.X.RemoveGadget)}}]:[],x=[];return d||(x.push({separator:!0}),p||x.push({label:"Export to CSV",icon:"fa fa-file-text",command:()=>w(f.T.CSV,u,i,t)}),m||x.push({label:"Export to Excel",icon:"fa fa-file-excel",command:()=>w(f.T.XLSX,u,i,t)}),y||x.push({label:"Export to PDF",icon:"fa fa-file-pdf",command:()=>w(f.T.PDF,u,i,t)})),[{label:"Toggle full screen",icon:"fa fa-"+(a?"compress":"expand"),command:()=>c()},...x,...v]}function w(e,t,r,n){const a=new m.b;a.fileName=t,a.format=e||e,a.element=r,n.trackEvent("Export data",g.Jk.GadgetActions,a.format),a.export()}var j=r(3580),k=r(2805),N=r(2351);const S=(0,N.Ue)((()=>({showParameters:!1,isFetching:!1}))),C=(0,N.Ue)((e=>({searchText:"",setSearchText:t=>e({searchText:t})}))),T=(0,N.Ue)((()=>({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]}))),A=(0,N.Ue)((e=>({itemPath:null,level:0,selectItem:(t,r)=>e({itemPath:t,level:r})})));function F(e,t,{args:{itemPath:r}}){const n=T.getState(),a=(0,j.V)(n,r,e),{fields:s}=a;T.setState({fields:s})}function E(e={}){T.setState({parameters:e})}function P(e){T.setState((()=>({jql:e})))}function $(e){T.setState((()=>({dataSourceType:e||1})))}function I(e){const{id:t,key:r,name:n,schema:a}=e;return{id:t,key:r,name:n,schema:a}}function R(e={}){const{jql:t,fields:r}=T.getState();return D(e,r),{jql:t,fields:Object.keys(e)}}function D(e,t){t&&t.forEach((t=>{var r;null!==(r=t.schema)&&void 0!==r&&r.derived&&t.key.includes(".")?e[t.key.split(".")[0]]=!0:t.key&&(e[t.key]=!0),D(e,t.subItems)}))}var G=r(357);const L=[{label:"Default",value:"DT_DF",props:void 0,type:"datetime"},{label:"Date only",value:"DT_DO",props:{dateOnly:!0},type:"datetime"},{label:"Age in days (words)",value:"DT_AG",props:{quick:!0},type:"datetime"},{label:"Age in days (number)",value:"DT_NM",props:{format:"num"},type:"datetime"},{label:"Issue Key with Status",value:"PT_KY_ST",props:{settings:{showStatus:!0}},type:"parent"},{label:"Issue Key only",value:"PT_KY",props:{settings:{showStatus:!1}},type:"parent"},{label:"Summary only",value:"PT_SM",props:{settings:{valueType:"summary",showStatus:!1}},type:"parent"},{label:"Summary with Status",value:"PT_SM_ST",props:{settings:{valueType:"summary",showStatus:!0}},type:"parent"},{label:"Both Key & Summary",value:"PT_BT",props:{settings:{valueType:"both",showStatus:!1}},type:"parent"},{label:"Key, Summary & Status",value:"PT_BT_ST",props:{settings:{valueType:"both",showStatus:!0}},type:"parent"},{label:"Key only",value:"PR_KY",props:{settings:{}},type:"project"},{label:"Name only",value:"PR_NM",props:{settings:{valueType:"name"}},type:"project"},{label:"Both Key & Name",value:"PR_BT",props:{settings:{valueType:"both"}},type:"project"},{label:"Formatted",value:"TS_FR",props:{format:!0},type:"timespent"},{label:"As Number",value:"TS_NM",props:{format:!1},type:"timespent"},{label:"Name only",value:"USR_NM",props:{settings:{showImage:!1}},type:"user"},{label:"Name with Image",value:"USR_NM_IMG",props:{settings:{showImage:!0}},type:"user"},{label:"Email only",value:"USR_EM",props:{settings:{valueType:"email",showImage:!1}},type:"user"},{label:"Email with Image",value:"USR_EM_IMG",props:{settings:{valueType:"email",showImage:!0}},type:"user"},{label:"Name & Email",value:"USR_BT",props:{settings:{valueType:"both",showImage:!1}},type:"user"},{label:"Name, Email & Image",value:"USR_BT_IMG",props:{settings:{valueType:"both",showImage:!0}},type:"user"}],M=L.reduce(((e,t)=>(e[t.value]=t.props,e)),{}),U=L.groupBy((e=>e.type)).reduce(((e,{key:t,values:r})=>(e[t]=r,e)),{});function O(e){const{schema:{type:t},format:r}=e,n=(0,G.ph)(t),a=r&&M[r];return a&&(n.props=a),{renderer:n}}function _(e){const{keyField:t}=(0,G.Y2)(e),{key:r}=e;return t?"function"===typeof t?e=>t(e[r]):t?e=>{var n;return null===(n=e[r])||void 0===n?void 0:n[t]}:e=>e[r]:e=>e[r]}function q(e,t){const{keyField:r}=(0,G.Y2)(e),{key:n}=e;return function(e,t,r){const n=n=>function(e,t){if(!t)return e;if("function"===typeof t)return t(e);if("string"===typeof t)return null===e||void 0===e?void 0:e[t];throw new Error("Key field is of unknown type: "+typeof t)}((0,j.a)(n,e),t)===r;return n}(n,r,t)}function B(e){return t=>t.key===e}U.date=U.datetime;var z=r(4611);const V="none",H=[{value:V,label:"No Aggregation",allowDistinct:!0},{value:"sum",label:"Sum",allowedFor:["number","timespent","date","datetime"]},{value:"avg",label:"Avg",allowedFor:["number","timespent","date","datetime"]},{value:"min",label:"Min",allowedFor:["number","timespent","date","datetime"]},{value:"max",label:"Max",allowedFor:["number","timespent","date","datetime"]},{value:"count",label:"Count",returnType:"number",allowDistinct:!0},{value:"merge",label:"Merge (CSV)",allowedFor:["string"]},{value:"first",label:"First value"},{value:"last",label:"Last value"}],Q=H.filter((e=>e.allowDistinct)).map((e=>e.value));const W={count:function(e,t){return t.map((0,z.K)(e)).filter((e=>e||0===e)).length},merge:function(e,t){return t.map((0,z.K)(e)).join(", ")},first:function(e,t){return(0,j.a)(t[0],e)},last:function(e,t){return(0,j.a)(t.last(),e)}};function J(e){const{agrFunc:t="first"}=e;return!(!t||t===V)}function K(e,t){if(!J(e))return null;const{agrFunc:r="first"}=e,n=W[r];return n?n(e.key,t,e):t[r](e.key)}var Z=r(816),Y=r.n(Z);const X=function(e){const{value:t,tagProps:r={}}=e;return t?(0,v.jsxs)("th",{"data-test-id":t.prop,className:"day-head"+(t.isHoliday?" holiday":""),...r,children:[t.dateNum,(0,v.jsx)("br",{}),(0,v.jsx)("span",{className:"day-name",children:t.day})]}):null};function ee(e,t,r,n,a,s){const[o,i]=s(r,t,a,n);return o&&(e.tagProps.colSpan=o),e.subItems=i,e}function te({date:e}){return{start:(e=Y()(e)).startOf("day").valueOf(),end:e.endOf("day").valueOf()}}function re({start:e,end:t},r){if(r){if(r.includes(".")){const[n,a]=r.split(".");return r=>r.map((r=>{let s=r[n];return s?Array.isArray(s)&&(s=s.filter((r=>{const n=r[a];return!!n&&Y()(n).isBetween(e,t,void 0,"[]")})),!s.length)?null:{...r,[n]:s}:null})).filter(Boolean)}return n=>n.filter((n=>{const a=n[r];return!!a&&Y()(a).isBetween(e,t,void 0,"[]")}))}}function ne(e,t,r,n,a,s){const o=ae[e.schema.type];if(o)return o(e,t,r,n,a,s);throw new Error(`Unknown field error. Type:-${e.schema.type}`)}const ae={"date-range":function(e,t,r,n,a,s){const{dateRange:o,rangeType:i="days",filterField:l,showTotal:c,showTotalFirst:u,subItems:d}=e,p=function(e,t){const{$utils:r,$userutils:n}=(0,y.f3)("UtilsService","UserUtilsService"),a=r.getDateArray(e,t).map((e=>({prop:e.format("yyyyMMdd"),date:e,dispFormat:e.format("MMM yyyy").toUpperCase(),month:e.getMonth(),week:Y()(e).week(),dayOfWeek:Y()(e).day(),day:e.format("DD").toUpperCase(),dateNum:e.getDate(),isHoliday:n.isHoliday(e)})));return a}(o.fromDate,o.toDate),m=c&&{headerText:"Total",colGroup:!0,enableGrouping:!0,depth:n,tagProps:{rowSpan:2},transformFn:re({start:Y()(o.fromDate).startOf("day"),end:Y()(o.toDate).endOf("day")},l)};if("days"===i){const e=function(e){return e.groupBy((e=>`${e.month}_${e.week}`)).map((({values:e})=>{const t=e.length;let r="";const{0:n,[t-1]:a}=e,{week:s,dispFormat:o,dateNum:i,date:l}=n,{dateNum:c,date:u}=a;return r=t>4?`${o}, ${i} to ${c} (W-${s})`:t>3?`${o}, ${i}-${c}`:t>2?`${o.split(" ")[0]} (W-${s})`:o.split(" ")[0],{display:r,days:t,values:e,start:Y()(l).startOf("day").valueOf(),end:Y()(u).endOf("day").valueOf()}}))}(p),{header:a}=t,o=a[n],i=a[n+1];m&&u&&o.push(ee(m,t,d,n+1,r,s));const c=e.map((e=>{const a={headerText:e.display,colGroup:!0,enableGrouping:!0,depth:n,tagProps:{colSpan:0},transformFn:re(e,l)};return o.push(a),a.subItems=e.values.map((e=>{const o={enableGrouping:!0,value:e,depth:n+1,tagProps:{},transformFn:re(te(e),l),renderer:{Component:X}};i.push(o);const[c,u]=s(d,t,r,n+1);return c?(o.tagProps.colSpan=c,a.tagProps.colSpan+=c):a.tagProps.colSpan+=1,o.subItems=u,o})),a}));return m&&!u&&o.push(ee(m,t,d,n+1,r,s)),[p.length,c]}}};function se(e,t){if(!t.length)return;const{agrFunc:r="first",key:n}=e;if(!r)return null;let a=[];if(!n.includes("."))throw new Error("Unhandled Error: Error Code:- CF_NO_DOT");{const[e,r]=n.split(".");a=t.flatMap((t=>{const{[e]:n}=t;return n?Array.isArray(n)?n.map((({[r]:e})=>e)):[n[r]]:[]}))}const s=oe[r];return s?s(a):a[r]()}const oe={count:function(e){return e.filter((e=>e||0===e)).length},merge:function(e){return e.join(", ")},first:function(e){return e[0]},last:function(e){return e.last()}};function ie(e,t){const[r,...n]=t;return r.preGroupFilter&&(e=r.preGroupFilter(e)),r.colGroup?[le(t,e)]:r.enableGrouping?function(e,t,r){return e.groupFn(t,((t,n)=>{const a={...e.cellProps,value:t};return r.length&&(a.subRows=ie(n,r)),a}))}(r,e,n):r.agrFunc?function(e,t,r){const n=pe(e,t);r.length&&(n.subRows=ie(t,r));return[n]}(r,e,n):ce(e,t)}function le(e,t){let r=t,n=null,a=t,s=null;return e.flatMap((e=>(e.transformFn&&n!==e.transformFn&&t.length?(n=e.transformFn,r=n(t,e),a=r):e.transformFn||(r=t),e.colGroupFn&&s!==e.colGroupFn?(s=e.colGroupFn,a=s(r,((e,t,r)=>({key:r,values:t})))):e.colGroupFn||(a=r),function(e,t){var r;const n=e.groupFilterFn?(null===(r=t.filter(e.groupFilterFn)[0])||void 0===r?void 0:r.values)||[]:t;return de(e,n)}(e,a))))}function ce(e,t){let r=null;const n=[];for(const a of e){const e=[];for(let s=0;s<t.length;s++){const o=t[s];if(o.enableGrouping){const r=t.slice(s);e[e.length-1].subRows=ie([a],r);break}const i=ue(o,a);if(Array.isArray(i)){if(o.colGroup){e.push(...i);continue}r||(r=t.slice(s));const a=ce(i,r),l=e.length?e[e.length-1]:null;l?l.subRows=a:n.push(...a);break}e.push(i)}e.length&&n.push(e)}return n}function ue(e,t){const r=!e.issueFilterFn||e.issueFilterFn(t);return de(e,r?[t]:[])}function de(e,t){return e.enableGrouping&&e.subItems?le(e.subItems,t).flat():e.colGroup?pe(e,t):function(e,t){var r;if(null!==(r=e.schema)&&void 0!==r&&r.derived){const r=function(e,t){const{key:r}=e;if(r.includes(".")){const[e,n]=r.split(".");return t.flatMap((t=>{const{[e]:r}=t;return r?Array.isArray(r)?r.map((r=>({...t,[e]:[r]}))):[r[n]]:[]}))}throw new Error("Unhandled Error: Error Code:- DF_NO_DOT")}(e,t);return r.length?1===r.length?{...e.cellProps,value:se(e,r)}:r:{...e.cellProps,value:null}}return{...e.cellProps,value:K(e,t)}}(e,t)}function pe(e,t){var r;const n=null!==(r=e.schema)&&void 0!==r&&r.derived?se(e,t):K(e,t);return{...e.cellProps,value:n}}function me(e,t){Array.isArray(e)?function(e,t){e.forEach((e=>fe(e,t)))}(e,t):fe(e,t)}function fe(e,t){const{subRows:r,...n}=e,a=t.length,s=t[a-1],o=s.length;s.push(n),null!==r&&void 0!==r&&r.length&&r.forEach(((e,r)=>{r&&t.push([]),me(e,t)}));const i=t.length-a+1;if(i>1&&(n.tagProps={rowSpan:i},o))for(let l=o-1;l>=0;l--){const e=s[l];e.tagProps?e.tagProps.rowSpan<i&&(e.tagProps.rowSpan=i):e.tagProps={rowSpan:i}}}var he=r(7062),ye=r.n(he);const ge="parameters",ve=[{name:ge,parameters:[{paramName:"paramName",type:"string"}],returns:["any"]},{name:"sum",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"avg",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"min",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"max",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"first",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"last",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"as_date",parameters:[{paramName:"value",type:["number","date","datetime","string"]},{paramName:"format",type:["string"],optional:!0}],returns:"datetime"},{name:"today",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"eod",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"startOfDay",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"now",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"date_diff",parameters:[{paramName:"date1",type:"datetime"},{paramName:"date2",type:"datetime"},{paramName:"unit",type:"string",optional:!0}],returns:"number"},{name:"startDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"endDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"currentUser",parameters:[],returns:"user"}].reduce(((e,t)=>(e[t.name.toLowerCase()]=t,e)),{});function xe(e){var t,r,n;return null===(t=ye().parse(`select * from json where (${e})`).value)||void 0===t||null===(r=t.where)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.value}function be(e,t){try{return function(e,t){if(!e||"string"===typeof e||!Array.isArray(e))return{isValid:!1,errorMessage:"Query is incomplete"};try{const r=function(e,t){return e.forEach((e=>{if(!ke[e.type])throw new Error("Query is incomplete. Missing comparison");we(e,t)})),t}(e,t);return{isValid:!0,json:e,result:r}}catch(r){return{errorMessage:r.message,json:e}}}(xe(e),t)}catch(r){return{isValid:!1,errorMessage:r.message}}}function we(e,t,r){const{type:n,operator:a}=e,s=Ne[n];if(!s)throw new Error(`Usage of ${a||n} is unsupported`);return function(e){let t=(null===e||void 0===e?void 0:e.type)||e;if(!t)return e;Array.isArray(t)?(t=t.map((e=>je[e]||e)).distinct(),t.length<2&&(t=t[0])):"string"===typeof t&&(t=je[t]||t);if(!t)return e;if("object"===typeof e&&!Array.isArray(e))return{...e,type:t};return t}(s(e,t,r))}const je={date:"datetime"};const ke={AndExpression:Se,OrExpression:Se,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:a}=e,s=we(r,t);if((a.includes("<")||a.includes(">"))&&!Ee(s,Ce))throw new Error(`Incompatible types used with "${a}" comparer`);const o=we(n,t,{type:s});if(!Ee(s,o))throw new Error(`"${a}" comparison done between incompatible types`)},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:a}}=e,s=we(r,t);if(!Ee(s,Ce))throw new Error("Incompatible types used with between predicate");const o=we(n,t,{type:s}),i=we(a,t,{type:s});if(!Ee(s,o)||!Ee(s,i)||!Ee(o,i))throw new Error("Between predicate used with in-compatible types")},LikePredicate:function(e,t){const{left:r,right:n}=e,a=we(r,t);if(Ee(a,Te))throw new Error("Like comparison is used with incompatible types");const{type:s,value:o}=n;if("string"!==s.toLowerCase())throw new Error("Only string is supported on right hand side of Like predicate");if(!["*",".","%","_"].some((e=>o.includes(e))))throw new Error("The string in right hand side of Like predicate doesn't contain any expressions and would never be met. Either use some expression or use other operators");if(o.replace(/[%.*]/g,"").length<3)throw new Error("The string in right hand side of Like predicate is too short. Either use some expression or use other operators");if(!Ee(we(n,t,{type:a}),["string"]))throw new Error("Like comparison done between incompatible types")},InExpressionListPredicate:function(e,t){const{left:r,right:n}=e,a=we(r,t);!function(e,t,r){const{value:n}=e;1===n.length&&(r={...r,isArray:!0});for(const a of n){const e=we(a,t,r);if(!Ee(r.type,e))throw new Error("List contains in-compatible types")}}(n,t,{type:a})}},Ne={...ke,Identifier:function(e,t){const{value:r}=e;let n=r.toLowerCase();n.startsWith("`")&&(n=n.substring(1,n.length-1));const a=t.fieldsMap[n];if(!a)throw new Error(`Unknown field ${r}`);return t.fields[n]=!0,a.schema},FunctionCall:function(e,t,r){const{name:n,params:a}=e,s=n.toLowerCase(),o=ve[s];if(!o)throw new Error(`Unknown function ${n}`);let{returns:i}=o;const{parameters:l}=o,c=(null===l||void 0===l?void 0:l.length)||0;1===(null===a||void 0===a?void 0:a.length)&&null===a[0]&&a.splice(0,1);if((null===a||void 0===a?void 0:a.length)>c)throw new Error(`Expected ${(null===l||void 0===l?void 0:l.length)||0} arguments for function "${n}", but passed ${(null===a||void 0===a?void 0:a.length)||0}`);for(let u=0;u<c;u++){const e=l[u],r=a[u];if(!r&&!e.optional)throw new Error(`Missing arguments for function ${n}`);const s=we(r,t,e);if(!Ee(s,e.type))throw new Error(`Type mismatch for argument ${u+1} on ${n}`);i===`:${e.paramName}`&&(i=(null===s||void 0===s?void 0:s.type)||s)}if("string"===typeof i&&i.startsWith(":"))throw new Error(`Unknown return type ${i} for function ${n}`);return Ae(s,a,t,r),i},Number:Fe,String:Fe,Boolean:Fe,Null:Fe};function Se(e,t){const{left:r,right:n}=e;we(r,t),we(n,t)}const Ce=["number","date","datetime","timespent"];const Te=["date","datetime","number","timespent"];function Ae(e,t,r,n){if(e===ge){var a;const e=t[0],s=e.type.toLowerCase();if("string"!==s)throw new Error(`Parameter name must be a string, but passed ${s}`);const o=e.value.substring(1,e.value.length-1);if(o.length<5)throw new Error("Parameter name is too short");if(o.length>27)throw new Error("Parameter name is too big");const i=o.toLowerCase(),l=r.parameters[i];if(l&&!Ee(n.type,l.type))throw new Error(`Parameter ${e.value} is used across incompatible types`);r.parameters[i]={name:o,type:(null===(a=n.type)||void 0===a?void 0:a.type)||n.type,isArray:n.isArray||void 0}}}function Fe(e){const{type:t}=e;return{type:t.toLowerCase()}}function Ee(e,t){return!(!e||!t)&&(e=Pe(e),t=Pe(t),!0===e||!0===t||e===t||("string"===e?!(!t.includes("string")&&t.includes("number")):"string"===t?!(!e.includes("string")&&e.includes("number")):e.some((e=>t.includes(e)))))}function Pe(e){if("object"===typeof e&&!Array.isArray(e)){const{type:t,compatibleTypes:r}=e;e=t,null!==r&&void 0!==r&&r.length&&(e=[...r,e])}if(!e||"null"===e||"any"===e)return!0;if("string"===e)return e;if(!Array.isArray(e)){if("any"===e)return!0;e=[e]}return!!e.includes("any")||e}function $e(){var e;const{$session:t}=(0,y.f3)("SessionService");return(0,k.vW)(null===(e=t.CurrentUser)||void 0===e?void 0:e.jiraUser)}function Ie(e){var t;return Re(null===(t=this.parameters[e.toLowerCase()])||void 0===t?void 0:t.value)}function Re(e){return Array.isArray(e)?e.map(Re):"string"===typeof e?e.toLowerCase():e}function De(e,t){return Y()(e,t).valueOf()}function Ge(e){return Y()(Me(e)).startOf("day").valueOf()}function Le(e){return Y()(Me(e)).endOf("day").valueOf()}function Me(e){e=function(e){if(!isNaN(e))return{amount:parseFloat(e),unit:"days"};const t=new RegExp("^([+-])(\\d*)(y|Q|M|w|d|h|m)$","g").exec(e);if(!t)return null;const[,r,n,a]=t;return{amount:parseInt(r+n),unit:a}}(e);let t=Y()();return e&&(t=t.add(e.amount,e.unit)),t.valueOf()}function Ue(e,t,r){Y()(e).diff(t,r).valueOf()}function Oe(e){return 0}function _e(e){return 0}function qe(e){return 0}function Be(e){return 0}function ze(e){return null}function Ve(e){return null}const He=(0,N.Ue)((()=>({fields:[],fieldsMap:{}})));async function Qe(){const e=await async function(){const{$jira:e}=(0,y.f3)("JiraService"),t=function(e){return e.filter(Je).map((e=>{const{id:t,key:r,name:n,custom:a}=e;let{schema:s}=e;return s||(s={type:r}),{id:t,key:r,name:n,custom:a,schema:s}})).orderBy((e=>e.name))}(await e.getCustomFields()),r=[],n=[],a={};t.forEach((e=>{let t=e.key.toLowerCase();if(a[t]&&e.id&&(t=e.id.toLowerCase()),a[t]=e,e.custom){const t=e.name.toLowerCase();a[t]||(a[t]=e),n.push(e)}else r.push(e)}));const s=[{id:"attachmentAuthor",key:"attachment.author",name:"Attachment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"attachmentCreated",key:"attachment.created",name:"Attachment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"attachmentFileName",key:"attachment.filename",name:"Attachment File Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentType",key:"attachment.mimeType",name:"Attachment Mime Type",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentSize",key:"attachment.size",name:"Attachment Size",schema:{type:"size",derived:!0,isArray:!0}},{id:"commentAuthor",key:"comment.author",name:"Comment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentCreated",key:"comment.created",name:"Comment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"commentBody",key:"comment.body",name:"Comment Body",schema:{type:"string",derived:!0,isArray:!0}},{id:"commentUpdateAuthor",key:"comment.updateAuthor",name:"Comment Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentUpdated",key:"comment.updated",name:"Comment Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"componentsDescription",key:"components.description",name:"Component Description",schema:{type:"string",derived:!0,isArray:!0}},{id:"componentsName",key:"components.name",name:"Component Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"dateRange",key:"",name:"Date Range",schema:{type:"date-range",computed:!0,depth:1}},{id:"fixVersionsArchived",key:"fixVersions.archived",name:"Fix Version Archived",schema:{type:"bool",derived:!0,isArray:!0}},{id:"fixVersionsName",key:"fixVersions.name",name:"Fix Version Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"fixVersionsReleaseDate",key:"fixVersions.releaseDate",name:"Fix Version Release Date",schema:{type:"date",derived:!0,isArray:!0}},{id:"fixVersionsReleased",key:"fixVersions.released",name:"Fix Version Released",schema:{type:"bool",derived:!0,isArray:!0}},{id:"worklogAuthor",key:"worklog.author",name:"Worklog Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogCreated",key:"worklog.created",name:"Worklog Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogComment",key:"worklog.comment",name:"Worklog Comment",schema:{type:"string",derived:!0,isArray:!0}},{id:"worklogTime",key:"worklog.started",name:"Worklog Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogTimespent",key:"worklog.timeSpentSeconds",name:"Worklog Time spent",schema:{type:"timespent",derived:!0,isArray:!0}},{id:"worklogUpdateAuthor",key:"worklog.updateAuthor",name:"Worklog Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogUpdated",key:"worklog.updated",name:"Worklog Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}}].orderBy((e=>e.name));return s.forEach((e=>{let{key:t}=e;t&&(a[t]&&(t=e.id),a[t.toLowerCase()]=e)})),{native:r,custom:n,derived:s,fieldsMap:a}}();He.setState({fields:[{label:"Native",items:e.native},{label:"Custom",items:e.custom},{label:"Derived",items:e.derived}],fieldsMap:e.fieldsMap})}const We=["worklog","comment","attachment"];function Je(e){return!We.includes(e.key)}const Ke={parent:["key","id"],project:["name","key"],user:["displayName","emailAddress","name","accountId"]};const Ze={parent:["key"],project:["name","key"],user:["displayName","emailAddress","name","accountId"]};const Ye=Object.keys(n).reduce(((e,t)=>(e[t.toLowerCase()]=n[t],e)),{});function Xe(e){if(null===e||void 0===e||!e.trim())return;const{fieldsMap:t}=He.getState(),{parameters:r={}}=T.getState(),n={fieldsMap:t,parameters:r},a=xe(e);return e=>e.map(function(e,t){const r=e.map((e=>et(e,t)));return e=>r.reduce(((e,t)=>e&&t(e)),e)}(a,n)).filter(Boolean)}function et(e,t){return(0,tt[e.type])(e,t)}const tt={AndExpression:rt,OrExpression:rt,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:a}=e,s=et(r,t),o=et(n,t);let i;i=s.returnsArrayOfValues?nt(a,s,o):o.returnsArrayOfValues?nt(a,o,s):function(e,t,r){switch(e){case"=":return e=>t(e)===r(e);case"!=":case"<>":return e=>t(e)!==r(e);case">":return e=>t(e)>r(e);case">=":return e=>t(e)>=r(e);case"<":return e=>t(e)<r(e);case"<=":return e=>t(e)<=r(e)}}(a,s,o);return e=>e&&i(e)?e:void 0},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:a}}=e,s=et(r,t),o=et(n,t),i=et(a,t);return e=>{const t=s(e);return t>=o(e)&&t<=i(e)}},InExpressionListPredicate:function(e,t){const{left:r,right:n,hasNot:a}=e,s=et(r,t);return function(e,t,r,n){var a;const{value:s}=e;let o=s.map((e=>et(e,t)));1===o.length&&"parameters"===(null===(a=s[0].name)||void 0===a?void 0:a.toLowerCase())&&"FunctionCall"===s[0].type&&(o=o[0]());return r.returnsArrayOfValues?e=>{const t=r(e);for(let r of o)if("function"===typeof r&&(r=r(e)),t.includes(r))return n?null:e;if(n)return e}:e=>{const t=r(e);for(const r of o)if(t===r(e))return n?null:e;if(n)return e}}(n,t,s,!!a)},LikePredicate:function(e,t){t={...t,isLikeComparison:!0};const{left:r,right:n,hasNot:a}=e,s=et(r,t);return function(e,t,r,n){let{value:a}=e;return a=a.substring(1,a.length-1),a=new RegExp(`^${a.replace(/%/g,".*").replace(/_/g,".")}$`,"im"),r.returnsArrayOfValues?e=>r(e).some((e=>a.test(e)))?n?null:e:n?e:void 0:e=>a.test(r(e))?n?null:e:n?e:void 0}(n,0,s,!!a)},Identifier:function(e,t){const{value:r}=e,n=r.toLowerCase(),a=t.fieldsMap[n],s=t.isLikeComparison?function(e){return(0,G.v9)(e,Ze,"name")}(a):function(e){return(0,G.v9)(e,Ke,["name","id"])}(a),{type:o,keyField:i}=s,l=a.key;let c=at;"date"!==o&&"datetime"!==o||(c=st);return i?Array.isArray(i)?(c=e=>{if(!e)return null;const t=e[l];return"object"!==typeof t?t:i.map((e=>{var r;return null!==(r=at(t[e]))&&void 0!==r?r:{}}))},c.returnsArrayOfValues=!0,c):"function"===typeof i?e=>{const t=null===e||void 0===e?void 0:e[l];return t&&c(i(t))}:e=>{var t;return c(null===e||void 0===e||null===(t=e[l])||void 0===t?void 0:t[i])}:e=>c(null===e||void 0===e?void 0:e[l])},FunctionCall:function(e,t){const{name:r,params:n}=e,a=r.toLowerCase(),s=Ye[a];1===(null===n||void 0===n?void 0:n.length)&&null===n[0]&&n.splice(0,1);const o=n.map((e=>et(e,t)));if(null!==o&&void 0!==o&&o.length&&o.some((e=>!e.isStaticValue)))return e=>e&&s.apply(t,o.map((t=>t(e))));{const e=s.apply(t,o.map((e=>e()))),r=()=>e;return s.isStaticValue=!0,r}},Number:ot,String:ot,Boolean:ot,Null:ot};function rt(e,t){const{left:r,right:n,operator:a}=e,s=et(r,t),o=et(n,t);return"and"===a?e=>s(e)&&o(e):e=>s(e)||o(e)}function nt(e,t,r){switch(e){case"=":return e=>t(e).includes(r(e));case"!=":case"<>":return e=>!t(e).includes(r(e))}}function at(e){return"string"===typeof e?e.toLowerCase():null!==e&&void 0!==e?e:null}function st(e){return e?Y()(e).valueOf():e}function ot(e){const{type:t,value:r}=e;let n=r;switch(t.toLowerCase()){case"string":n=at(r.substring(1,r.length-1));break;case"number":n=Number(r);break;case"boolean":n=Boolean(r);break;case"null":n=null;break;default:n=at(r)}const a=()=>n;return a.isStaticValue=!0,a}function it(e){var t;return null!==(t=e.schema)&&void 0!==t&&t.derived?function(e){if(e.key.includes(".")){const[t,r]=e.key.split("."),n=_({key:r,schema:e.schema});return(e,a)=>{const s={};for(const o of e){const e=o[t];Array.isArray(e)&&e.groupBy(n).forEach((({key:e,values:n})=>{let a=s[e];a||(a={key:e,value:n[0][r],issuesMap:{}},s[e]=a);let i=a.issuesMap[o.issuekey];if(i){const e=i[t];n.forEach((t=>e.push(t)))}else i={...o,[t]:n},a.issuesMap[o.issuekey]=i}))}return Object.values(s).map((({key:e,value:t,issuesMap:r})=>a(t,Object.values(r),e)))}}}(e):function(e){const t=_(e);return(r,n)=>r.groupBy(t).map((({key:t,values:r})=>n(r[0][e.key],r,t)))}(e)}function lt(e,t,r,n){return t=function(e,t,r){var n;const{id:a,key:s,name:o,headerText:i=o,enableGrouping:l,agrFunc:c,...u}=e,d={id:a,key:s,tagProps:t,headerText:i||o,cellProps:O(e),...u};c&&J(e)&&(d.agrFunc=c);l&&(!r||r.enableGrouping||null!==(n=e.schema)&&void 0!==n&&n.isArray)&&(d.enableGrouping=!0,d.groupFn=it(e),d.preGroupFilter=Xe(e.filter));return d}(e,{rowSpan:n},t),r.header[0].push(t),t}function ct(e,t){const{header:r}=e,[n]=r,a=ie(t,n);e.body=function(e,t=[]){for(const r of e)t.push([]),me(r,t);return t}(a)}function ut(e,t,r,n=-1){if(!e)return[0];n+=1;let a=0;const s=e.length>1,o=e.map((e=>{var o;const i=!e.enableGrouping&&n||null===(o=e.schema)||void 0===o||!o.computed?dt:ne,[l,c]=i(e,t,r,n,s,ut);return a+=l,c}));return[a,o]}function dt(e,t,r,n,a,s){const{header:o}=t,i=o[n],{key:l,subItems:c,name:u,headerText:d=u,showTotal:p,showTotalFirst:m,...f}=e,h=O(e);if(n||(f.enableGrouping=!0),!f.enableGrouping){const e={key:l,headerText:d,...f,colGroup:!0,depth:n,tagProps:{},cellProps:h};return a?(i.push(e),[1,e]):[0,e]}const y=Xe(e.filter);y&&(r=y(r));const g=p&&{headerText:"Total",colGroup:!0,enableGrouping:!0,depth:n,tagProps:{}};let v=0;const x=[];g&&m&&(i.push(g),x.push(g),v=mt(g,t,c,n,r));const b=it(e);let w=0;return b(r,((r,a,o)=>{const u={key:l,...f,colGroup:!0,depth:n,colGroupFn:b,groupFilterFn:B(o),issueFilterFn:q(e,o),value:r,...h,tagProps:{}};i.push(u);const[d,p]=s(c,t,a,n);d&&(u.tagProps.colSpan=d),p&&(u.subItems=p.flat()),w+=d,x.push(u)})),g&&!m&&(i.push(g),x.push(g),v=mt(g,t,c,n,r)),[w?w+v:x.length,x]}function pt(){const{fields:e}=T.getState();return ft({subItems:e.filter((e=>e.colGroup)),enableGrouping:!0})}function mt(e,t,r,n,a){const[s,o]=ut(r,t,a,n);return s&&(e.tagProps.colSpan=s),o&&(e.subItems=o.flat()),s||1}function ft(e,t,r=0,n=1){const{subItems:a,enableGrouping:s,schema:o={}}=e;if(o.computed&&o.depth?r+=o.depth:(s||t)&&(r+=1),null===a||void 0===a||!a.length)return n>r?n:r;const i=a.length>1,l=a.reduce(((e,t)=>ft(t,i,r,e)),r);return n>l?n:l}function ht(){const{jql:e,fields:t}=T.getState(),r=[];null!==e&&void 0!==e&&e.trim()||r.push("JQL is required to pull issues from Jira"),null!==t&&void 0!==t&&t.length||r.push("No fields selected to generate report");const{fieldsMap:n}=He.getState(),a={fieldsMap:n,fields:{},parameters:{}};if(t.forEach(((e,t)=>function(e,t,r,n,a){yt(e,t,r,n,a,e.colGroup)}(e,t,0,r,a))),!r.length)return a;S.setState({reportErrors:r,isFetching:!1},!0)}function yt(e,t,r,n,a,s,o=""){!function(e,t,r,n,a,s){const{name:o,filter:i}=e;if(null!==i&&void 0!==i&&i.trim()){const{isValid:e,errorMessage:r}=be(i,a);e||n.push(`Field ${s}"${o}" at position ${t+1} has error in filter query: (${r})`)}}(e,t,0,n,a,o),s?function(e,t,r,n,a=""){const{name:s,subItems:o,enableGrouping:i}=e,l=i||!r;l&&(null!==o&&void 0!==o&&o.length||n.push(`Grouping is enabled for field ${a}"${s}" at position ${t+1}, but do not contain row values. Drag and drop the field(s) to be shown as value under "${s}"`),null===o||void 0===o||o.forEach(((e,o)=>yt(e,o,r+1,n,!0,`${a}"${s}" (Position: ${t}) -> `))))}(e,t,r,n,o):function(e,t,r,n){const{id:a,name:s}=e;gt.includes(a)&&n.push(`Field "${s}" at position ${t+1} is currently not supported to be used as rows. Convert it to column group instead`)}(e,t,0,n)}const gt=["dateRange"];async function vt(){const e=ht();if(e&&function({parameters:e}){const{parameters:t={}}=T.getState(),{showParameters:r,parameters:n}=Object.values(e).reduce(((e,r)=>{const n=r.name.toLowerCase();let a=t[n];return a&&a.type===r.type&&a.isArray===r.isArray||(a={name:r.name,type:r.type,isArray:r.isArray}),a.value||(e.showParameters=!0),e.parameters[n]=a,e}),{showParameters:!1,parameters:{}});T.setState({parameters:n}),r&&S.setState({showParameters:!0},!0);return!r}(e)){S.setState({reportErrors:null,isFetching:!0});try{const t=await async function(e){const{jql:t,fields:r}=R(e.fields),{$jira:n}=(0,y.f3)("JiraService");return(await n.searchTickets(t,r)).map((({id:e,key:t,fields:r})=>function(e){return e.worklog&&(e.worklog=e.worklog.worklogs),e.comment&&(e.comment=e.comment.comments),e}({...r,id:e,issuekey:t})))}(e),r={header:new Array(pt()).fill(null).map((()=>[])),body:[],footer:[]};!function(e,t){const{fields:r}=T.getState(),n=e.header.length;let a;r.forEach((r=>{r.colGroup?ut([r],e,t):a=lt(r,a,e,n)}))}(r,t),ct(r,t),S.setState({reportData:r,isFetching:!1},!0)}catch(r){let e=["Unknown error occurred while generating report. Look at console log for more details"];var t;if(400===r.status)e=(null===(t=r.error)||void 0===t?void 0:t.errorMessages)||e;console.error("Error generating pivot report:- ",r),S.setState({reportErrors:e,isFetching:!1},!0)}}}async function xt(e){const{id:t}=e,{$report:r}=(0,y.f3)("ReportService"),n=await r.saveQuery(e,!0);return t!==n&&r.getReportDefinition(n)}var bt=r(5937),wt=r(9230);const jt=function({title:e,onBackClick:t,show:r,onHide:n,children:a,contentClassName:s,controls:o}){return(0,v.jsx)("div",{className:"side-bar-container "+(r?"open":"closed"),children:(0,v.jsxs)("div",{className:"site-bar-block",children:[(0,v.jsxs)("div",{className:"header"+(t?" ps-0":""),children:[(0,v.jsx)(i.zx,{className:"close-icon",icon:"fa fa-times",onClick:n,title:"Hide this block"}),o,t&&(0,v.jsx)(i.zx,{className:"back-icon float-start",icon:"fa fa-arrow-left",onClick:t,title:"Configure data source"}),(0,v.jsx)("h2",{className:"title",children:e})]}),(0,v.jsx)("div",{className:d()("site-bar-content",s),children:a})]})})};const kt=function(){const e=He((({fields:e})=>e));return a.useEffect((()=>{Qe()}),[]),(0,v.jsxs)("div",{className:"fields-collection",children:[(0,v.jsx)(Nt,{}),(0,v.jsx)("div",{className:"fields-group-view",children:e.map((e=>(0,v.jsx)(St,{fields:e.items,title:e.label},e.label)))})]})};function Nt(){const{searchText:e,setSearchText:t}=C();return(0,v.jsxs)("div",{className:"search-container",children:[(0,v.jsx)("span",{className:"fa fa-search"}),(0,v.jsx)(i.zC,{value:e,placeholder:"type here to search for fields...",onChange:t})]})}function St({fields:e,title:t}){var r,n;const s=null===(r=C((({searchText:e})=>e)))||void 0===r||null===(n=r.trim())||void 0===n?void 0:n.toLowerCase(),[o,l]=a.useState((()=>Ct(e,s)));return a.useEffect((()=>{l(Ct(e,s))}),[s,e,l]),null!==o&&void 0!==o&&o.length?(0,v.jsxs)("div",{className:"fields-list",children:[(0,v.jsx)("div",{className:"block font-bold",children:t}),o.map(((e,t)=>(0,v.jsxs)(i._l,{className:"jira-field",itemType:"jira-field",item:e,children:[(0,v.jsx)("span",{className:"fa fa-copy float-end pointer",onClick:t=>function(e,t){var r;(0,k.sT)(e);let n=t.custom?t.name:t.key;n.includes(" ")&&(n=`\`${n}\``);null!==(r=navigator.clipboard)&&void 0!==r&&r.writeText&&navigator.clipboard.writeText(n)}(t,e),title:"Click to copy field for query filter"}),(0,v.jsx)("span",{children:e.name})]},t)))]}):null}function Ct(e,t){if(!t)return e;return e.filter((e=>e.name.toLowerCase().includes(t)||e.key.toLowerCase().includes(t)))}function Tt({item:e},{index:t}){const r=I(e);T.setState((({fields:e})=>((e=[...e]).splice(t,0,r),{fields:e})))}function At(e){T.setState((({fields:t})=>((t=[...t]).splice(e,1),{fields:t}))),A.setState({itemPath:null})}function Ft(e,t){T.setState((({fields:r})=>((r=[...r])[t]=e,{fields:r})))}function Et(e){T.setState({fields:e})}const Pt=function({item:e,index:t,depth:r,dragProps:n}){const s=a.useCallback((e=>{(0,k.sT)(e),At(t)}),[t]),{itemPath:o,selectItem:i}=A(),l=a.useCallback((()=>i(`fields.${t}`,r)),[t,r,i]);return(0,v.jsx)("div",{className:"row-item"+(o?" selected":""),onClick:l,children:(0,v.jsxs)("div",{className:"row-config-head",ref:n.dragRef,children:[(0,v.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:s}),(0,v.jsx)("span",{className:"icon fa-solid fa-up-down-left-right"}),e.displayText||e.name]})})},$t=["jira-field"],It=[];function Rt(e){return{...e,subItems:[...e.subItems||[]]}}function Dt({path:e,item:t,depth:r,index:n,dragProps:s,removeItem:l,updateItem:c}){const u=a.useRef();a.useEffect((()=>{u.current={index:n,item:t,updateItem:c}}),[n,t,c]);const[p,m]=(0,o.Z)(!0),f=a.useCallback((({itemType:e,item:t},{index:r})=>{"jira-field"===e&&(t=I(t));const{item:n,index:a,updateItem:s}=u.current,o=Rt(n);o.subItems.splice(r,0,t),s(o,a)}),[]),h=a.useCallback((e=>{const{item:t,index:r,updateItem:n}=u.current,a=Rt(t);a.subItems.splice(e,1),n(a,r)}),[]),y=a.useCallback((()=>l(u.current.index)),[l]),g=a.useCallback(((e,t)=>{const{item:r,index:n,updateItem:a}=u.current,s=Rt(r);s.subItems[t]=e,a(s,n)}),[]),x=a.useCallback((e=>{const{item:t,index:r,updateItem:n}=u.current;n({...t,subItems:e},r)}),[]),{itemPath:b,selectItem:w}=A(),j=a.useCallback((t=>{(0,k.sT)(t),w(e,r)}),[e,r,w]),N=0===r||t.enableGrouping,S=d()("icon-col fa",{pointer:N,"fa-angle-down":N&&p,"fa-angle-right":N&&!p,"fa-arrow-right":!N});return(0,v.jsxs)("div",{className:"col-item"+(b===e?" selected":""),onClick:j,children:[(0,v.jsxs)("div",{className:"col-config-head",ref:s.dragRef,children:[(0,v.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:y}),N&&(0,v.jsx)("span",{className:"icon-pivot float-end fa-solid fa-table-columns me-2",title:"This field would be pivoted as column"}),(0,v.jsx)("span",{className:S,onClick:m}),t.displayText||t.name]}),p&&N&&(0,v.jsx)(i.bt,{addPlaceholder:!0,className:"sub-items",useDragRef:!0,items:t.subItems||It,accept:$t,defaultItemType:"col-sub-group",onDrop:f,onChange:x,placeholder:`Drag and drop sub group or value field for ${t.name}`,children:(t,n,{draggable:a})=>(0,v.jsx)(Dt,{path:`${e}.subItems.${n}`,index:n,depth:r+1,item:t,dragProps:a,removeItem:h,updateItem:g},n)})]})}const Gt=function({...e}){return(0,v.jsx)(Dt,{...e,removeItem:At,updateItem:Ft})};const Lt=function(){return(0,v.jsx)("div",{className:"pivot-config",children:(0,v.jsx)(Ot,{})})},Mt=["jira-field"],Ut=(0,v.jsx)("span",{className:"p-3 block",children:"Drag and drop required fields from list to be shown in report"});function Ot(){const e=T((({fields:e})=>e));return(0,v.jsxs)("div",{className:"fields-config",children:[(0,v.jsx)("strong",{children:"Report Fields"}),(0,v.jsx)(i.bt,{placeholder:Ut,useDragRef:!0,items:e,accept:Mt,defaultItemType:"row-group",onDrop:Tt,onChange:Et,children:(e,t,{draggable:r})=>e.colGroup?(0,v.jsx)(Gt,{item:e,index:t,dragProps:r,depth:0,path:`fields.${t}`},t):(0,v.jsx)(Pt,{index:t,item:e,depth:0,dragProps:r},t)})]})}var _t=r(4262);const qt=[{value:"days",label:"Days with Week"},{value:"week",label:"Week with Month"}];const Bt=function({isRow:e}){const t=He((({fields:e})=>e)),r=a.useMemo((()=>t.map((({label:e,items:t})=>({label:e,items:t.filter((e=>{var t,r,n;return(null===(t=e.schema)||void 0===t||null===(r=t.type)||void 0===r?void 0:r.startsWith("date"))&&"date-range"!==(null===(n=e.schema)||void 0===n?void 0:n.type)}))})))),[t]);return(0,v.jsxs)("div",{className:"display-options",children:[(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Date Range:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(_t.I0,{field:"dateRange",range:!0})})]}),!e&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Range Type:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(_t.xw,{field:"rangeType",dataset:qt,autoSelect:!0})})]}),(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Filter issues with:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(_t.xw,{field:"filterField",dataset:r,valueField:"key",optionLabel:"name",optionGroupLabel:"label",optionGroupChildren:"items",filter:!0,grouped:!0})})]})]})},zt={any:function({item:e,isGrouped:t,isRow:r}){var n,a;const s=!t&&function(e,t){return H.filter((r=>(!r.allowedFor||r.allowedFor.includes(e))&&(t||r.value!==V)))}(null===(n=e.schema)||void 0===n?void 0:n.type,r),o=!t&&((i=e.agrFunc)&&Q.includes(i));var i;const l=U[(null===(a=e.schema)||void 0===a?void 0:a.type)||""];return(0,v.jsxs)("div",{className:"display-options",children:[s&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Function:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(_t.xw,{field:"agrFunc",dataset:s,autoSelect:!0})})]}),o&&(0,v.jsx)("div",{className:"label-value-pair",children:(0,v.jsx)(_t.z8,{field:"useDistinct",label:"Use distinct values only",disabled:!0})}),l&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Formatting:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(_t.xw,{field:"format",dataset:l,autoSelect:!0})})]})]})},"date-range":Bt};const Vt=function({filterText:e}){return(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Filter Query:"}),(0,v.jsx)(_t.yi,{className:"w-100",field:"filter",multiline:!0}),(0,v.jsx)(Ht,{filterText:e})]})};function Ht({filterText:e}){const[t,r]=a.useState({}),n=He((e=>e.fieldsMap)),s=a.useRef(n);return s.current=n,a.useEffect((()=>{if(null!==e&&void 0!==e&&e.trim()){const t={fieldsMap:s.current,fields:{},parameters:{}};r(be(e,t))}else r({})}),[e,r]),t.isValid?null:(0,v.jsx)("div",{className:"msg-error",children:t.errorMessage})}const Qt=function({selection:e}){var t;const{itemPath:r,item:n,isRow:s,level:o,selectItem:l}=e,c=a.useCallback((()=>l()),[l]);if(!n)return null;const u=n.enableGrouping||!s&&0===o,d=zt[null===(t=n.schema)||void 0===t?void 0:t.type]||zt.any;return(0,v.jsxs)("div",{className:"item-properties",children:[(0,v.jsx)(i.zx,{icon:"fa fa-times",className:"float-end",onClick:c}),(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Field name:"}),(0,v.jsx)("span",{className:"prop-value",children:n.name})]}),(0,v.jsx)(_t.l0,{value:n,onChange:F,args:{itemPath:r,isRow:s},children:(0,v.jsxs)("div",{className:"config-props",children:[!o&&(0,v.jsx)(_t.z8,{field:"colGroup",label:"Make this a column group field"}),(s||!!o)&&(0,v.jsx)(_t.z8,{label:"Enable grouping",field:"enableGrouping"}),(s||!u)&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Header text"})," ",(0,v.jsx)(_t.yi,{field:"headerText",maxLength:35,placeholder:n.name||"Custom header text for column"})]}),u&&(0,v.jsx)(_t.z8,{className:"inline-block",label:"Show totals",field:"showTotal"}),u&&(0,v.jsx)(_t.lA,{className:"inline-block btn-sm float-end",onLabel:"At start",offLabel:"At end",field:"showTotalFirst",disabled:!n.showTotal}),d&&(0,v.jsx)(d,{item:n,isGrouped:u,isRow:s}),u&&(0,v.jsx)(Vt,{filterText:n.filter})]})})]})};var Wt=r(218),Jt=r(9110),Kt=r(6552);const Zt=function({reportId:e}){const t=(0,s.s0)(),[r,n]=(0,o.Z)(!1),l=a.useCallback((async()=>{e?await function(){const{hasChanges:e,...t}=T.getState();return xt(t)}():n()}),[e,n]),c=a.useCallback((()=>{!function(e){const{id:t,queryName:r,createdBy:n}=T.getState();Kt.Z.confirmDelete(`Are you sure to delete the report named "${r}" permanently?`).then((()=>{const{$report:a,$message:s,$analytics:o}=(0,y.f3)("ReportService","MessageService","AnalyticsService");a.deleteSavedQuery(t).then((t=>{s.success(`Pivot report "${r}" deleted successfully`),o.trackEvent("Pivot Report Deleted"),e(n)}))}))}((e=>{t(`/${e}/reports/pivot`)}))}),[t]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"controls float-end",children:[!!e&&(0,v.jsx)(i.zx,{icon:"fa fa-trash",className:"mx-1",severity:"danger",onClick:c,title:"Delete this report"}),(0,v.jsx)(i.zx,{icon:"fa fa-save",className:"mx-1",onClick:l,title:"Save this report"}),!!e&&(0,v.jsx)(i.zx,{icon:"fa fa-copy",className:"mx-1",onClick:n,title:"Rename report or save as new report"})]}),r&&(0,v.jsx)(Jt.Z,{allowCopy:!!e,onHide:n,onChange:async(e,r)=>{const a=await function(e,t){const{hasChanges:r,...n}=T.getState();return n.queryName=e,t&&delete n.id,xt(n)}(e,r);if(n(),a){const{id:e,createdBy:r}=a;t(`/${r}/reports/pivot/${e}`)}}})]})};const Yt=function({show:e,onHide:t,reportId:r}){const[n,a]=(0,o.Z)(!r),s=(0,v.jsx)(Zt,{reportId:r,onToggleDataSource:a});return(0,v.jsx)(jt,{show:e,onHide:t,title:"Report Config",onBackClick:n?void 0:a,controls:s,width:"500",contentClassName:"p-0",children:(0,v.jsx)("div",{className:"editor-controls",children:n?(0,v.jsx)(Xt,{onDone:a}):(0,v.jsx)(er,{})})})};function Xt({onDone:e}){const{jql:t,dataSourceType:r}=T((({jql:e,dataSourceType:t})=>({jql:e,dataSourceType:t})));return(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("p",{children:"Select a data source option for retrieving a list of issues. You have the choice of utilizing direct Jira Query Language (JQL) queries or extracting a list of issues based on a specific sprint and subsequently applying a JQL filter to refine the results."}),(0,v.jsx)("label",{className:"font-bold mt-3",children:"Data source type:"}),(0,v.jsx)(wt.EU,{className:"block",value:r,defaultValue:1,label:"Use raw JQL to filter and pull issues list",onChange:$}),(0,v.jsx)(wt.EU,{className:"block",value:r,defaultValue:2,label:"Pull issues for select sprints and apply JQL filter",onChange:$,disabled:!0}),(0,v.jsx)("label",{className:"font-bold mt-3",children:"JQL Query:"}),(0,v.jsx)(Wt.Z,{jql:t,plugged:!0,onChange:P}),(0,v.jsx)(i.zx,{className:"float-end me-2",icon:"fa fa-arrow-right",iconPos:"right",label:"Select fields",disabled:2!==r&&(null===t||void 0===t?void 0:t.length)<5,onClick:e,title:"Configure data source"})]})}function er(){const e=function(){const{itemPath:e,level:t,selectItem:r}=A(),n=T((t=>e?(0,k.aM)(t,e):null));if(!n)return{};const a=!n.colGroup&&!t;return{item:n,itemPath:e,isRow:a,level:t,selectItem:r}}(),t=!(null===e||void 0===e||!e.item);let r=(0,v.jsxs)("div",{className:"field-config",children:[(0,v.jsx)(Lt,{}),(0,v.jsx)(kt,{})]});return t&&(r=(0,v.jsxs)(bt.q,{style:{height:"100%"},layout:"vertical",children:[(0,v.jsx)(bt.E,{style:{height:"10%"},children:r}),(0,v.jsx)(bt.E,{style:{height:"5%"},children:(0,v.jsx)(Qt,{selection:e})})]})),(0,v.jsx)("div",{className:"controls",children:r})}var tr=r(1329);const rr=function(){const e=T((({queryName:e})=>e)),t=S((({reportData:e})=>e));return(0,v.jsx)("div",{className:"group-table-container",children:(0,v.jsxs)(tr.TT,{className:"group-table table-bordered",exportSheetName:e,children:[(0,v.jsx)(nr,{rows:t.header,tag:tr.Et,isHeader:!0}),(0,v.jsx)(nr,{rows:t.body,tag:tr.XP})]})})};function nr({tag:e,isHeader:t,rows:r}){return(0,v.jsx)(e,{children:r.map(((e,r)=>(0,v.jsx)(ar,{isHeader:t,cells:e},r)))})}function ar({isHeader:e,cells:t}){return(0,v.jsx)("tr",{children:t.map(((t,r)=>(0,v.jsx)(sr,{isHeader:e,cell:t},r)))})}function sr({isHeader:e,cell:t}){const r=e?"th":"td",{value:n,headerText:a,tagProps:s,renderer:{Component:o,props:i}={}}=t;if(o)return(0,v.jsx)(o,{...i,value:n,tag:r,tagProps:s});{const t=(e?a:n)||" ";return(0,v.jsx)(r,{...s,children:t})}}var or=r(3682);const ir=function(){return(0,v.jsx)("div",{className:"pad-15",children:(0,v.jsxs)("section",{children:[(0,v.jsx)("h2",{children:"How to Use the Pivot Report"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"Start by providing a JQL query to filter data from Jira."}),(0,v.jsx)("li",{children:"Easily customize your report by dragging and dropping fields from the right corner into the Report Fields section."}),(0,v.jsx)("li",{children:"You have the flexibility to display data as regular rows with grouping or mark specific fields as column groups for a column-based layout."}),(0,v.jsx)("li",{children:"Utilize Column Groups to organize and present your data in columns, offering a structured view of your information."}),(0,v.jsx)("li",{children:"Make use of subgroups and filters within column groups to further refine your report's content."}),(0,v.jsx)("li",{children:"To preview your report, simply click on the preview icon located at the top of the report interface."})]}),(0,v.jsxs)("p",{children:["To know more about Pivot report, have a look at ",(0,v.jsx)(i.rU,{href:`${or.ov}/features/reports/pivot`,children:"documentation"})]}),(0,v.jsxs)("p",{children:["To report a bug or suggest improvements to the report, visit ",(0,v.jsx)(i.rU,{href:`${or.zv}/discussions/329`,children:"GitHub discussions"})]}),(0,v.jsx)("h2",{children:"Upcoming Enhancements"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"The ability to sort the data under each group."}),(0,v.jsx)("li",{children:"The ability to display totals for each group, offering a more comprehensive view of your data."}),(0,v.jsx)("li",{children:"Support for utilizing parent, sub-tasks and linked issues, allowing you to explore relationships and dependencies within your data."}),(0,v.jsx)("li",{children:"Enhanced support for pulling issues based on sprints, in addition to JQL queries, for a more dynamic reporting experience."})]}),(0,v.jsx)("h2",{children:"Future Enhancements"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"Enhanced support for adding the Pivot Report as a gadget on your dashboard, providing seamless integration with your Jira workflow."}),(0,v.jsx)("li",{children:"Exciting new features, including the option to add chart views based on your data, enabling richer data visualization."})]}),(0,v.jsx)("br",{}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:"Please Note:"})," This report is currently undergoing development and is not yet considered fully operational. We strongly request you to manually validate the output before using it for any business purpose. If you encounter any unexpected errors or if the output does not align with your expectations, we kindly request that you report the issue to us. Your assistance in improving the report's reliability is greatly appreciated."]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:"When reporting issues"}),", we kindly ask you to provide the following details:"]}),(0,v.jsxs)("ol",{children:[(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Screenshots:"})," Include screenshots that illustrate the problem or discrepancies you've encountered. Visual aids can significantly assist us in identifying issues."]}),(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Console Error Logs:"})," If applicable, please provide any error messages or console logs related to the problem. These logs can offer valuable insights into the root cause of the issue."]}),(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Custom Fields:"})," If the issue pertains to specific custom fields, please specify the type of custom fields involved. This information can help us pinpoint and address field-specific challenges more effectively."]})]}),(0,v.jsx)("p",{children:"Your feedback and collaboration are instrumental in ensuring the quality and reliability of this report. We appreciate your patience and assistance as we work to enhance its performance."})]})]})})};const lr=function(){const{hasReportData:e,reportErrors:t,isFetching:r,showParameters:n}=S((({reportData:e,reportErrors:t,isFetching:r,showParameters:n})=>({hasReportData:!!e,reportErrors:t,isFetching:r,showParameters:n})));return r?(0,v.jsx)("div",{className:"editor-body p-4",children:(0,v.jsx)("strong",{children:"Please wait while the data is being pulled from Jira. This may take a while depending on the number of issues being pulled."})}):(0,v.jsxs)("div",{className:"editor-body",children:[t&&(0,v.jsx)(cr,{errors:t}),n&&(0,v.jsx)(ur,{}),e&&(0,v.jsx)(rr,{}),!e&&!n&&(0,v.jsx)(ir,{})]})};function cr({errors:e}){return(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("h2",{children:"Report Definition Error"}),(0,v.jsx)("p",{children:"The report definition has one or more errors. Please fix it before you try to generate report"}),(0,v.jsx)("ul",{className:"msg-error",children:e.map(((e,t)=>(0,v.jsx)("li",{children:e},t)))})]})}function ur(){const e=T((({parameters:e})=>e)),t=Object.keys(e);return(0,v.jsx)(_t.l0,{value:e,onChange:E,children:(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("strong",{children:"Provide values for missing parameters to generate report:"}),(0,v.jsx)("br",{}),t.map((t=>(0,v.jsxs)("div",{className:"param-field py-3",children:[(0,v.jsxs)("label",{className:"font-bold me-3",children:[e[t].name,": "]}),(0,v.jsx)(dr,{...e[t]})]},t))),(0,v.jsx)("br",{}),(0,v.jsx)(wt.zx,{icon:"fa fa-refresh",label:"Generate Report",onClick:vt})]})})}function dr({type:e,isArray:t,name:r}){const n=`${r.toLowerCase()}.value`;switch(e){default:return t?(0,v.jsx)(_t.Z0,{field:n,clearIfEmpty:!0}):(0,v.jsx)(_t.yi,{field:n});case"daterange":return(0,v.jsx)(_t.I0,{field:n,range:!0});case"datetime":return(0,v.jsx)(_t.I0,{field:n,showTime:!0});case"date":return(0,v.jsx)(_t.I0,{field:n,showTime:!1});case"usergroup":return(0,v.jsx)("span",{className:"link",children:"Select users"})}}const pr=function(){const{reportId:e}=(0,s.UO)(),[t,r]=(0,o.Z)(!e);a.useEffect((()=>{!async function(e){if(!e)return T.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),void S.setState({},!0);const{$report:t}=(0,y.f3)("ReportService"),r=await t.getReportDefinition(e),{$message:n}=(0,y.f3)("MessageService");r?"pivot"!==r.reportType?(T.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report "${r.queryName}" is not a valid Pivot Report.`,"Report Incompatible")):T.setState(r,!0):(T.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report id "${e}" is invalid or the report has been deleted.`,"Report Not Found"))}(e)}),[e]);const n=S((({isFetching:e})=>e)),{queryName:l,parameters:c}=T((({queryName:e,parameters:t})=>({queryName:e,parameters:t}))),u=c&&Object.keys(c).length>0,d=(0,v.jsxs)(v.Fragment,{children:[u&&(0,v.jsx)(i.zx,{type:"secondary",icon:"fa fa-list-check",className:"mx-1",onClick:mr,title:"Show report parameters"}),(0,v.jsx)(i.zx,{type:"secondary",icon:"fa fa-edit",className:"mx-1",onClick:r,title:"Edit report definition"})]});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Yt,{reportId:e,show:t,onHide:r}),(0,v.jsx)("div",{className:"page-container",children:(0,v.jsx)(x,{title:l?`${l} - [Pivot report]`:"Pivot report",isGadget:!1,isLoading:n,customActions:d,onRefresh:vt,children:(0,v.jsx)(lr,{})})})]})};function mr(){S.setState((({showParameters:e})=>({showParameters:!e})))}}}]);