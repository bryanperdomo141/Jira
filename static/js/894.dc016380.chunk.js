"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[894],{9110:(e,t,r)=>{r.d(t,{Z:()=>o});r(7313);var n=r(1783),a=r(3400),s=r(6417);class i extends n.Z{constructor(e){super(e,"Save Report As"),this.nameChanged=e=>this.setState({newQueryName:e}),this.copyChanged=e=>this.setState({copyQuery:e}),this.done=()=>{const{newQueryName:e,copyQuery:t}=this.state;this.props.onChange(e,t)},this.style={width:"350px"},this.state={showDialog:!0,newQueryName:e.queryName||"",copyQuery:!1}}getFooter(){const{state:{newQueryName:e}}=this;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.zx,{text:!0,type:"secondary",label:"Cancel",onClick:this.onHide}),(0,s.jsx)(a.zx,{type:"primary",icon:"fa fa-save",label:"Save",disabled:!e||e.length<3,onClick:this.done})]})}render(){const{props:{allowCopy:e},state:{newQueryName:t,copyQuery:r}}=this;return super.renderBase((0,s.jsxs)("div",{className:"pad-15",children:[(0,s.jsx)("label",{children:"Report Name"}),(0,s.jsx)("div",{children:(0,s.jsx)(a.zC,{value:t,onChange:this.nameChanged,style:{width:"100%"}})}),e&&(0,s.jsx)("div",{children:(0,s.jsx)(a.XZ,{checked:r,onChange:this.copyChanged,label:"Save as new report"})})]}))}}const o=i},8313:(e,t,r)=>{r.r(t),r.d(t,{default:()=>nr});var n={};r.r(n),r.d(n,{as_date:()=>Ae,avg:()=>De,currentUser:()=>Fe,date_diff:()=>Re,first:()=>Me,last:()=>Ue,max:()=>Le,min:()=>Ge,now:()=>Pe,parameters:()=>Te,sum:()=>Ie,today:()=>Ee,todayEOD:()=>$e});var a=r(7313),s=r(8467),i=r(8244),o=r(3400),l=r(9642),c=r(2328),u=r(6123),d=r.n(u),p=r(1485),m=r(2362),f=r(7154),h=r(551),y=r(6310),g=r(6444),v=(r(7340),r(6417));const x=function(e){const{title:t,iconClass:r,hideRefresh:n,gadgetHint:s,hideMenu:i,isLoading:u,customActions:m,onRefresh:f,settings:g}=e,x=a.useRef({}),j=!1!==e.isGadget,w=g||{fullWidth:!1,fullHeight:!1},[k,N]=(0,a.useState)(w.fullWidth||!1),[C,S]=(0,a.useState)(w.fullHeight||!1),[F,T]=(0,a.useState)(!1),A=a.useId();(0,a.useEffect)((()=>{g&&(N(g.fullWidth),S(g.fullHeight))}),[g]);const{$analytics:E}=(0,y.f3)("AnalyticsService"),$=()=>{T(!F),F?document.body.classList.remove("fs-layout"):document.body.classList.add("fs-layout")},P=(t,r)=>{e.onAction&&e.onAction({type:t,data:r},e.model,e.index)};x.current.props=e,x.current.isGadget=j,x.current.fullWidth=k,x.current.fullHeight=C,x.current.isFullScreen=F,x.current.$analytics=E,x.current.setSizeOptions=(e,t)=>{w.fullWidth=e,w.fullHeight=t,N(e),S(t),R()},x.current.toggleFullScreen=$,x.current.performAction=P;const R=()=>{P(h.X.SettingsChanged,w)},I=e=>(0,p.pT)(e,b(x.current)),D=a.useCallback((e=>(0,p.pT)(e,b(x.current))),[]),{children:G,tabLayout:L,gadgetType:M}=e;if(L)return(0,v.jsx)(v.Fragment,{children:G});const U=k||!j,q=C||!j,O=d()("gadget",e.className,{docked:!j,"full-width":U&&!F,"full-height":q&&!F,"half-width":!U&&!F,"half-height":!q&&!F,"full-screen":F});return(0,v.jsxs)("div",{ref:t=>{x.current.rootEl=t;const{dropProps:{dropConnector:r}={}}=e;r&&r(t)},className:O,"data-test-id":M,children:[u&&(0,v.jsx)(o.aN,{}),(0,v.jsx)(l.Panel,{header:(()=>{const{subTitle:a,draggableHandle:l}=e,d="gadget-header"+(l?" movable":"");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{ref:l,className:d,onContextMenu:j?I:null,onDoubleClick:$,children:[(0,v.jsx)("i",{className:`fa ${r}`})," ",t," ",a&&(0,v.jsxs)("span",{children:[" - ",a]}),(0,v.jsxs)("div",{className:"float-end",children:[s?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.u,{target:`.icon-hint-${A}`,children:s}),(0,v.jsx)("i",{className:`fa fa-info-circle icon-hint icon-hint-${A}`,"data-pr-position":"bottom"})]}):null,m,!n&&(0,v.jsx)(o.zx,{text:!0,icon:"fa fa-refresh",disabled:u,onClick:p||f,title:"Refresh data"}),!i&&(0,v.jsx)(o.zx,{text:!0,icon:"fa fa-wrench",onClick:D})]})]}),(0,v.jsx)("div",{className:"clearfix"})]});var p})(),children:G})]})};function b(e){const{$analytics:t,performAction:r,isGadget:n,isFullScreen:a,fullWidth:s,fullHeight:i,rootEl:o,setSizeOptions:l,toggleFullScreen:c,props:{title:u,hideExport:d,hideCSVExport:p,hideXLSXExport:m,hidePDFExport:y}}=e,v=n?[{separator:!0},{label:"Full width",icon:`fa fa-${s?"check-":""}circle fs-16 margin-r-5`,command:()=>l(!s,i)},{label:"Full height",icon:`fa fa-${i?"check-":""}circle fs-16 margin-r-5`,command:()=>l(s,!i)},{separator:!0},{label:"Remove",icon:"fa fa-remove",command:()=>{t.trackEvent("Gadget removed",g.Jk.GadgetActions,u),r(h.X.RemoveGadget)}}]:[],x=[];return d||(x.push({separator:!0}),p||x.push({label:"Export to CSV",icon:"fa fa-file-text",command:()=>j(f.T.CSV,u,o,t)}),m||x.push({label:"Export to Excel",icon:"fa fa-file-excel",command:()=>j(f.T.XLSX,u,o,t)}),y||x.push({label:"Export to PDF",icon:"fa fa-file-pdf",command:()=>j(f.T.PDF,u,o,t)})),[{label:"Toggle full screen",icon:"fa fa-"+(a?"compress":"expand"),command:()=>c()},...x,...v]}function j(e,t,r,n){const a=new m.b;a.fileName=t,a.format=e||e,a.element=r,n.trackEvent("Export data",g.Jk.GadgetActions,a.format),a.export()}var w=r(3580),k=r(2805),N=r(2351);const C=(0,N.Ue)((()=>({isFetching:!1}))),S=(0,N.Ue)((e=>({searchText:"",setSearchText:t=>e({searchText:t})}))),F=(0,N.Ue)((()=>({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]}))),T=(0,N.Ue)((e=>({itemPath:null,level:0,selectItem:(t,r)=>e({itemPath:t,level:r})})));function A(e,t,{args:{itemPath:r}}){const n=F.getState(),a=(0,w.V)(n,r,e),{fields:s}=a;F.setState({fields:s})}function E(e={}){F.setState({parameters:e})}function $(e){F.setState((()=>({jql:e})))}function P(e){F.setState((()=>({dataSourceType:e||1})))}function R(e){const{id:t,key:r,name:n,schema:a}=e;return{id:t,key:r,name:n,schema:a}}function I(e={}){const{jql:t,fields:r}=F.getState();return D(e,r),{jql:t,fields:Object.keys(e)}}function D(e,t){t&&t.forEach((t=>{var r;null!==(r=t.schema)&&void 0!==r&&r.derived&&t.key.includes(".")?e[t.key.split(".")[0]]=!0:t.key&&(e[t.key]=!0),D(e,t.subItems)}))}var G=r(2251);function L(e){const{schema:{type:t}}=e;return{renderer:(0,G.ph)(t)}}function M(e){const{keyField:t}=(0,G.Y2)(e),{key:r}=e;return t?"function"===typeof t?e=>t(e[r]):t?e=>{var n;return null===(n=e[r])||void 0===n?void 0:n[t]}:e=>e[r]:e=>e[r]}function U(e,t){const{keyField:r}=(0,G.Y2)(e),{key:n}=e;return function(e,t,r){const n=n=>function(e,t){if(!t)return e;if("function"===typeof t)return t(e);if("string"===typeof t)return null===e||void 0===e?void 0:e[t];throw new Error("Key field is of unknown type: "+typeof t)}((0,w.a)(n,e),t)===r;return n}(n,r,t)}function q(e){return t=>t.key===e}var O=r(4611);const z="none",B=[{value:z,label:"No Aggregation",allowDistinct:!0},{value:"sum",label:"Sum",allowedFor:["number","timespent","date","datetime"]},{value:"avg",label:"Avg",allowedFor:["number","timespent","date","datetime"]},{value:"min",label:"Min",allowedFor:["number","timespent","date","datetime"]},{value:"max",label:"Max",allowedFor:["number","timespent","date","datetime"]},{value:"count",label:"Count",returnType:"number",allowDistinct:!0},{value:"merge",label:"Merge (CSV)",allowedFor:["string"]},{value:"first",label:"First item"},{value:"last",label:"Last item"}],H=B.filter((e=>e.allowDistinct)).map((e=>e.value));const V={count:function(e,t){return t.map((0,O.K)(e)).filter((e=>e||0===e)).length},merge:function(e,t){return t.map((0,O.K)(e)).join(", ")},first:function(e,t){return(0,w.a)(t[0],e)},last:function(e,t){return(0,w.a)(t.last(),e)}};function Q(e){const{agrFunc:t="first"}=e;return!(!t||t===z)}function W(e,t){if(!Q(e))return null;const{agrFunc:r="first"}=e,n=V[r];return n?n(e.key,t,e):t[r](e.key)}var J=r(816),_=r.n(J);const Z=function(e){const{value:t,tagProps:r={}}=e;return t?(0,v.jsxs)("th",{"data-test-id":t.prop,className:"day-head"+(t.isHoliday?" holiday":""),...r,children:[t.dateNum,(0,v.jsx)("br",{}),(0,v.jsx)("span",{className:"day-name",children:t.day})]}):null};function Y({date:e}){return{start:(e=_()(e)).startOf("day").valueOf(),end:e.endOf("day").valueOf()}}function X({start:e,end:t},r){if(r){if(r.includes(".")){const[n,a]=r.split(".");return r=>r.map((r=>{let s=r[n];return s?Array.isArray(s)&&(s=s.filter((r=>{const n=r[a];return!!n&&_()(n).isBetween(e,t,void 0,"[]")})),!s.length)?null:{...r,[n]:s}:null})).filter(Boolean)}return n=>n.filter((n=>{const a=n[r];return!!a&&_()(a).isBetween(e,t,void 0,"[]")}))}}function K(e,t,r,n,a,s){const i=ee[e.schema.type];if(i)return i(e,t,r,n,a,s);throw new Error(`Unknown field error. Type:-${e.schema.type}`)}const ee={"date-range":function(e,t,r,n,a,s){const{dateRange:i,rangeType:o="days",filterField:l,subItems:c}=e,u=function(e,t){const{$utils:r,$userutils:n}=(0,y.f3)("UtilsService","UserUtilsService"),a=r.getDateArray(e,t).map((e=>({prop:e.format("yyyyMMdd"),date:e,dispFormat:e.format("MMM yyyy").toUpperCase(),month:e.getMonth(),week:_()(e).week(),dayOfWeek:_()(e).day(),day:e.format("DD").toUpperCase(),dateNum:e.getDate(),isHoliday:n.isHoliday(e)})));return a}(i.fromDate,i.toDate);if("days"===o){const e=function(e){return e.groupBy((e=>`${e.month}_${e.week}`)).map((({values:e})=>{const t=e.length;let r="";const{0:n,[t-1]:a}=e,{week:s,dispFormat:i,dateNum:o,date:l}=n,{dateNum:c,date:u}=a;return r=t>4?`${i}, ${o} to ${c} (W-${s})`:t>3?`${i}, ${o}-${c}`:t>2?`${i.split(" ")[0]} (W-${s})`:i.split(" ")[0],{display:r,days:t,values:e,start:_()(l).startOf("day").valueOf(),end:_()(u).endOf("day").valueOf()}}))}(u),{header:a}=t,i=a[n],o=a[n+1];return[u.length,e.map((e=>{const a={headerText:e.display,colGroup:!0,enableGrouping:!0,depth:n,tagProps:{colSpan:0},transformFn:X(e,l)};return i.push(a),a.subItems=e.values.map((e=>{const i={enableGrouping:!0,value:e,depth:n+1,tagProps:{},transformFn:X(Y(e),l),renderer:{Component:Z}};o.push(i);const[u,d]=s(c,t,r,n+1);return u?(i.tagProps.colSpan=u,a.tagProps.colSpan+=u):a.tagProps.colSpan+=1,i.subItems=d,i})),a}))]}}};function te(e,t){if(!t.length)return;const{agrFunc:r="first",key:n}=e;if(!r)return null;let a=[];if(!n.includes("."))throw new Error("Unhandled Error: Error Code:- CF_NO_DOT");{const[e,r]=n.split(".");a=t.flatMap((t=>{const{[e]:n}=t;return n?Array.isArray(n)?n.map((({[r]:e})=>e)):[n[r]]:[]}))}const s=re[r];return s?s(a):a[r]()}const re={count:function(e){return e.filter((e=>e||0===e)).length},merge:function(e){return e.join(", ")},first:function(e){return e[0]},last:function(e){return e.last()}};function ne(e,t){const[r,...n]=t;return r.preGroupFilter&&(e=r.preGroupFilter(e)),r.colGroup?[ae(t,e)]:r.enableGrouping?function(e,t,r){return e.groupFn(t,((t,n)=>{const a={...e.cellProps,value:t};return r.length&&(a.subRows=ne(n,r)),a}))}(r,e,n):r.agrFunc?function(e,t,r){const n=le(e,t);r.length&&(n.subRows=ne(t,r));return[n]}(r,e,n):se(e,t)}function ae(e,t){let r=t,n=null,a=t,s=null;return e.flatMap((e=>(e.transformFn&&n!==e.transformFn&&t.length?(n=e.transformFn,r=n(t,e),a=r):e.transformFn||(r=t),e.colGroupFn&&s!==e.colGroupFn?(s=e.colGroupFn,a=s(r,((e,t,r)=>({key:r,values:t})))):e.colGroupFn||(a=r),function(e,t){var r;const n=e.groupFilterFn?(null===(r=t.filter(e.groupFilterFn)[0])||void 0===r?void 0:r.values)||[]:t;return oe(e,n)}(e,a))))}function se(e,t){let r=null;const n=[];for(const a of e){const e=[];for(let s=0;s<t.length;s++){const i=t[s];if(i.enableGrouping){const r=t.slice(s);e[e.length-1].subRows=ne([a],r);break}const o=ie(i,a);if(Array.isArray(o)){if(i.colGroup){e.push(...o);continue}r||(r=t.slice(s));const a=se(o,r),l=e.length?e[e.length-1]:null;l?l.subRows=a:n.push(...a);break}e.push(o)}e.length&&n.push(e)}return n}function ie(e,t){const r=!e.issueFilterFn||e.issueFilterFn(t);return oe(e,r?[t]:[])}function oe(e,t){return e.enableGrouping&&e.subItems?ae(e.subItems,t).flat():e.colGroup?le(e,t):function(e,t){var r;if(null!==(r=e.schema)&&void 0!==r&&r.derived){const r=function(e,t){const{key:r}=e;if(r.includes(".")){const[e,n]=r.split(".");return t.flatMap((t=>{const{[e]:r}=t;return r?Array.isArray(r)?r.map((r=>({...t,[e]:[r]}))):[r[n]]:[]}))}throw new Error("Unhandled Error: Error Code:- DF_NO_DOT")}(e,t);return r.length?1===r.length?{...e.cellProps,value:te(e,r)}:r:{...e.cellProps,value:null}}return{...e.cellProps,value:W(e,t)}}(e,t)}function le(e,t){var r;const n=null!==(r=e.schema)&&void 0!==r&&r.derived?te(e,t):W(e,t);return{...e.cellProps,value:n}}function ce(e,t){Array.isArray(e)?function(e,t){e.forEach((e=>ue(e,t)))}(e,t):ue(e,t)}function ue(e,t){const{subRows:r,...n}=e,a=t.length;t[a-1].push(n),null!==r&&void 0!==r&&r.length&&r.forEach(((e,r)=>{r&&t.push([]),ce(e,t)}));const s=t.length-a+1;s>1&&(n.tagProps={rowSpan:s})}var de=r(7062),pe=r.n(de);const me="parameters",fe=[{name:me,parameters:[{paramName:"paramName",type:"string"}],returns:["any"]},{name:"sum",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"avg",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"min",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"max",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"first",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"last",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"as_date",parameters:[{paramName:"value",type:["number","date","datetime","string"]},{paramName:"format",type:["string"],optional:!0}],returns:"datetime"},{name:"today",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"eod",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"startOfDay",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"now",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"date_diff",parameters:[{paramName:"date1",type:"datetime"},{paramName:"date2",type:"datetime"},{paramName:"unit",type:"string",optional:!0}],returns:"number"},{name:"startDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"endDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"currentUser",parameters:[],returns:"user"}].reduce(((e,t)=>(e[t.name.toLowerCase()]=t,e)),{});function he(e){var t,r,n;return null===(t=pe().parse(`select * from json where (${e})`).value)||void 0===t||null===(r=t.where)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.value}function ye(e,t){try{return function(e,t){if(!e||"string"===typeof e||!Array.isArray(e))return{isValid:!1,errorMessage:"Query is incomplete"};try{const r=function(e,t){return e.forEach((e=>{if(!xe[e.type])throw new Error("Query is incomplete. Missing comparison");ge(e,t)})),t}(e,t);return{isValid:!0,json:e,result:r}}catch(r){return{errorMessage:r.message,json:e}}}(he(e),t)}catch(r){return{isValid:!1,errorMessage:r.message}}}function ge(e,t,r){const{type:n,operator:a}=e,s=be[n];if(!s)throw new Error(`Usage of ${a||n} is unsupported`);return function(e){let t=(null===e||void 0===e?void 0:e.type)||e;if(!t)return e;Array.isArray(t)?(t=t.map((e=>ve[e]||e)).distinct(),t.length<2&&(t=t[0])):"string"===typeof t&&(t=ve[t]||t);if(!t)return e;if("object"===typeof e&&!Array.isArray(e))return{...e,type:t};return t}(s(e,t,r))}const ve={date:"datetime"};const xe={AndExpression:je,OrExpression:je,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:a}=e,s=ge(r,t);if((a.includes("<")||a.includes(">"))&&!Ce(s,we))throw new Error(`Incompatible types used with "${a}" comparer`);const i=ge(n,t,{type:s});if(!Ce(s,i))throw new Error(`"${a}" comparison done between incompatible types`)},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:a}}=e,s=ge(r,t);if(!Ce(s,we))throw new Error("Incompatible types used with between predicate");const i=ge(n,t,{type:s}),o=ge(a,t,{type:s});if(!Ce(s,i)||!Ce(s,o)||!Ce(i,o))throw new Error("Between predicate used with in-compatible types")},LikePredicate:function(e,t){const{left:r,right:n}=e,a=ge(r,t);if(!Ce(a,["string"]))throw new Error("Like comparison is used with incompatible types");const s=ge(n,t,{type:a});if(!Ce(a,s))throw new Error("Like comparison done between incompatible types")},InExpressionListPredicate:function(e,t){const{left:r,right:n}=e,a=ge(r,t);!function(e,t,r){const{value:n}=e;for(const a of n){const e=ge(a,t,r);if(!Ce(r.type,e))throw new Error("List contains in-compatible types")}}(n,t,{type:a})}},be={...xe,Identifier:function(e,t){const{value:r}=e,n=r.toLowerCase(),a=t.fieldsMap[n];if(!a)throw new Error(`Unknown field ${r}`);return t.fields[n]=!0,a.schema},FunctionCall:function(e,t,r){const{name:n,params:a}=e,s=n.toLowerCase(),i=fe[s];if(!i)throw new Error(`Unknown function ${n}`);let{returns:o}=i;const{parameters:l}=i,c=(null===l||void 0===l?void 0:l.length)||0;1===(null===a||void 0===a?void 0:a.length)&&null===a[0]&&a.splice(0,1);if((null===a||void 0===a?void 0:a.length)>c)throw new Error(`Expected ${(null===l||void 0===l?void 0:l.length)||0} arguments for function "${n}", but passed ${(null===a||void 0===a?void 0:a.length)||0}`);for(let u=0;u<c;u++){const e=l[u],r=a[u];if(!r&&!e.optional)throw new Error(`Missing arguments for function ${n}`);const s=ge(r,t,e);if(!Ce(s,e.type))throw new Error(`Type mismatch for argument ${u+1} on ${n}`);o===`:${e.paramName}`&&(o=(null===s||void 0===s?void 0:s.type)||s)}if("string"===typeof o&&o.startsWith(":"))throw new Error(`Unknown return type ${o} for function ${n}`);return ke(s,a,t,r),o},Number:Ne,String:Ne,Boolean:Ne,Null:Ne};function je(e,t){const{left:r,right:n}=e;ge(r,t),ge(n,t)}const we=["number","date","datetime","timespent"];function ke(e,t,r,n){if(e===me){var a;const e=t[0],s=e.type.toLowerCase();if("string"!==s)throw new Error(`Parameter name must be a string, but passed ${s}`);const i=e.value.substring(1,e.value.length-1);if(i.length<5)throw new Error("Parameter name is too short");if(i.length>27)throw new Error("Parameter name is too big");const o=i.toLowerCase(),l=r.parameters[o];if(l&&!Ce(n.type,l.type))throw new Error(`Parameter ${e.value} is used across incompatible types`);r.parameters[o]={name:i,type:(null===(a=n.type)||void 0===a?void 0:a.type)||n.type}}}function Ne(e){const{type:t}=e;return{type:t.toLowerCase()}}function Ce(e,t){return!(!e||!t)&&(e=Se(e),t=Se(t),!0===e||!0===t||e===t||("string"===e?!(!t.includes("string")&&t.includes("number")):"string"===t?!(!e.includes("string")&&e.includes("number")):e.some((e=>t.includes(e)))))}function Se(e){if("object"===typeof e&&!Array.isArray(e)){const{type:t,compatibleTypes:r}=e;e=t,null!==r&&void 0!==r&&r.length&&(e=[...r,e])}if(!e||"null"===e||"any"===e)return!0;if("string"===e)return e;if(!Array.isArray(e)){if("any"===e)return!0;e=[e]}return!!e.includes("any")||e}function Fe(){var e;const{$session:t}=(0,y.f3)("SessionService");return(0,k.vW)(null===(e=t.CurrentUser)||void 0===e?void 0:e.jiraUser)}function Te(e){return this.parameters[e.toLowerCase()]}function Ae(e,t){return _()(e,t).valueOf()}function Ee(e){return _()(Pe(e)).startOf("day").valueOf()}function $e(e){return _()(Pe(e)).endOf("day").valueOf()}function Pe(e){e=function(e){if(!isNaN(e))return{amount:parseFloat(e),unit:"days"};const t=new RegExp("^([+-])(\\d*)(y|Q|M|w|d|h|m)$","g").exec(e);if(!t)return null;const[,r,n,a]=t;return{amount:parseInt(r+n),unit:a}}(e);let t=_()();return e&&(t=t.add(e.amount,e.unit)),t.valueOf()}function Re(e,t,r){_()(e).diff(t,r).valueOf()}function Ie(e){return 0}function De(e){return 0}function Ge(e){return 0}function Le(e){return 0}function Me(e){return null}function Ue(e){return null}const qe=(0,N.Ue)((()=>({fields:[],fieldsMap:{}})));async function Oe(){const e=await async function(){const{$jira:e}=(0,y.f3)("JiraService"),t=function(e){return e.filter(Be).map((e=>{const{id:t,key:r,name:n,custom:a}=e;return{id:t,key:r,name:n,custom:a,schema:(0,G.Y2)(e)}})).orderBy((e=>e.name))}(await e.getCustomFields()),r=[],n=[],a={};t.forEach((e=>{let t=e.key.toLowerCase();if(a[t]&&e.id&&(t=e.id.toLowerCase()),a[t]=e,e.custom){const t=e.name.toLowerCase();a[t]||(a[t]=e),n.push(e)}else r.push(e)}));const s=[{id:"attachmentAuthor",key:"attachment.author",name:"Attachment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"attachmentCreated",key:"attachment.created",name:"Attachment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"attachmentFileName",key:"attachment.filename",name:"Attachment File Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentType",key:"attachment.mimeType",name:"Attachment Mime Type",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentSize",key:"attachment.size",name:"Attachment Size",schema:{type:"size",derived:!0,isArray:!0}},{id:"commentAuthor",key:"comment.author",name:"Comment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentCreated",key:"comment.created",name:"Comment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"commentBody",key:"comment.body",name:"Comment Body",schema:{type:"string",derived:!0,isArray:!0}},{id:"commentUpdateAuthor",key:"comment.updateAuthor",name:"Comment Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentUpdated",key:"comment.updated",name:"Comment Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"componentsDescription",key:"components.description",name:"Component Description",schema:{type:"string",derived:!0,isArray:!0}},{id:"componentsName",key:"components.name",name:"Component Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"dateRange",key:"",name:"Date Range",schema:{type:"date-range",computed:!0,depth:1}},{id:"fixVersionsArchived",key:"fixVersions.archived",name:"Fix Version Archived",schema:{type:"bool",derived:!0,isArray:!0}},{id:"fixVersionsName",key:"fixVersions.name",name:"Fix Version Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"fixVersionsReleaseDate",key:"fixVersions.releaseDate",name:"Fix Version Release Date",schema:{type:"date",derived:!0,isArray:!0}},{id:"fixVersionsReleased",key:"fixVersions.released",name:"Fix Version Released",schema:{type:"bool",derived:!0,isArray:!0}},{id:"worklogAuthor",key:"worklog.author",name:"Worklog Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogCreated",key:"worklog.created",name:"Worklog Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogComment",key:"worklog.comment",name:"Worklog Comment",schema:{type:"string",derived:!0,isArray:!0}},{id:"worklogTime",key:"worklog.started",name:"Worklog Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogTimespent",key:"worklog.timeSpentSeconds",name:"Worklog Time spent",schema:{type:"timespent",derived:!0,isArray:!0}},{id:"worklogUpdateAuthor",key:"worklog.updateAuthor",name:"Worklog Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogUpdated",key:"worklog.updated",name:"Worklog Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}}].orderBy((e=>e.name)).map((e=>(e.schema={...e.schema,...(0,G.Y2)(e)},e)));return s.forEach((e=>{let{key:t}=e;t&&(a[t]&&(t=e.id),a[t.toLowerCase()]=e)})),{native:r,custom:n,derived:s,fieldsMap:a}}();qe.setState({fields:[{label:"Native",items:e.native},{label:"Custom",items:e.custom},{label:"Derived",items:e.derived}],fieldsMap:e.fieldsMap})}const ze=["worklog","comment","attachment"];function Be(e){return!ze.includes(e.key)}const He=Object.keys(n).reduce(((e,t)=>(e[t.toLowerCase()]=n[t],e)),{});function Ve(e){if(null===e||void 0===e||!e.trim())return;const{fieldsMap:t}=qe.getState(),{parameters:r={}}=F.getState(),n={fieldsMap:t,parameters:r},a=he(e);return e=>e.map(function(e,t){const r=e.map((e=>Qe(e,t)));return e=>r.reduce(((e,t)=>e&&t(e)),e)}(a,n)).filter(Boolean)}function Qe(e,t){return(0,We[e.type])(e,t)}const We={AndExpression:Je,OrExpression:Je,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:a}=e,s=Qe(r,t),i=Qe(n,t),o=function(e,t,r){switch(e){case"=":return e=>t(e)===r(e);case"!=":case"<>":return e=>t(e)!==r(e);case">":return e=>t(e)>r(e);case">=":return e=>t(e)>=r(e);case"<":return e=>t(e)<r(e);case"<=":return e=>t(e)<=r(e)}}(a,s,i);return e=>e&&o(e)?e:void 0},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:a}}=e,s=Qe(r,t),i=Qe(n,t),o=Qe(a,t);return e=>{const t=s(e);return t>=i(e)&&t<=o(e)}},InExpressionListPredicate:function(e,t){const{left:r,right:n}=e,a=Qe(r,t);return function(e,t,r){const{value:n}=e,a=n.map((e=>Qe(e,t)));return e=>{const t=r(e);for(const r of a)if(t===r(e))return e}}(n,t,a)},Identifier:function(e,t){const{value:r}=e,n=r.toLowerCase(),a=t.fieldsMap[n],s=(0,G.Y2)(a),{type:i,keyField:o}=s,l=a.key;let c=_e;"date"!==i&&"datetime"!==i||(c=Ze);return o?"function"===typeof o?e=>{const t=null===e||void 0===e?void 0:e[l];return t&&c(o(t))}:e=>{var t;return c(null===e||void 0===e||null===(t=e[l])||void 0===t?void 0:t[o])}:e=>c(null===e||void 0===e?void 0:e[l])},FunctionCall:function(e,t){const{name:r,params:n}=e,a=r.toLowerCase(),s=He[a];1===(null===n||void 0===n?void 0:n.length)&&null===n[0]&&n.splice(0,1);const i=n.map((e=>Qe(e,t)));if(null!==i&&void 0!==i&&i.length)return e=>e&&s.apply(t,i.map((t=>t(e))));{const e=s();return()=>e}},Number:Ye,String:Ye,Boolean:Ye,Null:Ye};function Je(e,t){const{left:r,right:n,operator:a}=e,s=Qe(r,t),i=Qe(n,t);return"and"===a?e=>s(e)&&i(e):e=>s(e)||i(e)}function _e(e){return"string"===typeof e?e.toLowerCase():null!==e&&void 0!==e?e:null}function Ze(e){return e?_()(e).valueOf():e}function Ye(e){const{type:t,value:r}=e;let n=r;switch(t.toLowerCase()){case"string":n=_e(r.substring(1,r.length-1));break;case"number":n=Number(r);break;case"boolean":n=Boolean(r);break;case"null":n=null;break;default:n=_e(r)}return()=>n}function Xe(e){var t;return null!==(t=e.schema)&&void 0!==t&&t.derived?function(e){if(e.key.includes(".")){const[t,r]=e.key.split("."),n=M({key:r,schema:e.schema});return(e,a)=>{const s={};for(const i of e){const e=i[t];Array.isArray(e)&&e.groupBy(n).forEach((({key:e,values:n})=>{let a=s[e];a||(a={key:e,value:n[0][r],issuesMap:{}},s[e]=a);let o=a.issuesMap[i.issuekey];if(o){const e=o[t];n.forEach((t=>e.push(t)))}else o={...i,[t]:n},a.issuesMap[i.issuekey]=o}))}return Object.values(s).map((({key:e,value:t,issuesMap:r})=>a(t,Object.values(r),e)))}}}(e):function(e){const t=M(e);return(r,n)=>r.groupBy(t).map((({key:t,values:r})=>n(r[0][e.key],r,t)))}(e)}function Ke(e,t,r,n){return t=function(e,t,r){var n;const{id:a,key:s,name:i,headerText:o=i,enableGrouping:l,agrFunc:c,...u}=e,d={id:a,key:s,tagProps:t,headerText:o||i,cellProps:L(e),...u};c&&Q(e)&&(d.agrFunc=c);l&&(!r||r.enableGrouping||null!==(n=e.schema)&&void 0!==n&&n.isArray)&&(d.enableGrouping=!0,d.groupFn=Xe(e),d.preGroupFilter=Ve(e.filter));return d}(e,{rowSpan:n},t),r.header[0].push(t),t}function et(e,t){const{header:r}=e,[n]=r,a=ne(t,n);e.body=function(e,t=[]){for(const r of e)t.push([]),ce(r,t);return t}(a)}function tt(e,t,r,n=-1){if(!e)return[0];n+=1;let a=0;const s=e.length>1,i=e.map((e=>{var i;const o=!e.enableGrouping&&n||null===(i=e.schema)||void 0===i||!i.computed?rt:K,[l,c]=o(e,t,r,n,s,tt);return a+=l,c}));return[a,i]}function rt(e,t,r,n,a,s){const{header:i}=t,o=i[n],{key:l,subItems:c,name:u,headerText:d=u,...p}=e,m=L(e);if(n||(p.enableGrouping=!0),!p.enableGrouping){const e={key:l,headerText:d,...p,colGroup:!0,depth:n,tagProps:{},cellProps:m};return a?(o.push(e),[1,e]):[0,e]}const f=Ve(e.filter);f&&(r=f(r));const h=Xe(e),y=[];let g=0;return h(r,((r,a,i)=>{const u={key:l,...p,colGroup:!0,depth:n,colGroupFn:h,groupFilterFn:q(i),issueFilterFn:U(e,i),value:r,...m,tagProps:{}};o.push(u);const[d,f]=s(c,t,a,n);d&&(u.tagProps.colSpan=d),f&&(u.subItems=f.flat()),g+=d,y.push(u)})),[g||y.length,y]}function nt(){const{fields:e}=F.getState();return at({subItems:e.filter((e=>e.colGroup)),enableGrouping:!0})}function at(e,t,r=0,n=1){const{subItems:a,enableGrouping:s,schema:i={}}=e;if(i.computed&&i.depth?r+=i.depth:(s||t)&&(r+=1),null===a||void 0===a||!a.length)return n>r?n:r;const o=a.length>1,l=a.reduce(((e,t)=>at(t,o,r,e)),r);return n>l?n:l}function st(){const{jql:e,fields:t}=F.getState(),r=[];null!==e&&void 0!==e&&e.trim()||r.push("JQL is required to pull issues from Jira"),null!==t&&void 0!==t&&t.length||r.push("No fields selected to generate report");const{fieldsMap:n}=qe.getState(),a={fieldsMap:n,fields:{},parameters:{}};if(t.forEach(((e,t)=>function(e,t,r,n,a){it(e,t,r,n,a,e.colGroup)}(e,t,0,r,a))),!r.length)return a;C.setState({reportErrors:r,isFetching:!1},!0)}function it(e,t,r,n,a,s,i=""){!function(e,t,r,n,a,s){const{name:i,filter:o}=e;if(null!==o&&void 0!==o&&o.trim()){const{isValid:e,errorMessage:r}=ye(o,a);e||n.push(`Field ${s}"${i}" at position ${t+1} has error in filter query: (${r})`)}}(e,t,0,n,a,i),s?function(e,t,r,n,a=""){const{name:s,subItems:i,enableGrouping:o}=e,l=o||!r;l&&(null!==i&&void 0!==i&&i.length||n.push(`Grouping is enabled for field ${a}"${s}" at position ${t+1}, but do not contain row values. Drag and drop the field(s) to be shown as value under "${s}"`),null===i||void 0===i||i.forEach(((e,i)=>it(e,i,r+1,n,!0,`${a}"${s}" (Position: ${t}) -> `))))}(e,t,r,n,i):function(e,t,r,n){const{id:a,name:s}=e;ot.includes(a)&&n.push(`Field "${s}" at position ${t+1} is currently not supported to be used as rows. Convert it to column group instead`)}(e,t,0,n)}const ot=["dateRange"];async function lt(){const e=st();if(e&&function({parameters:e}){const{parameters:t={}}=F.getState(),{showParameters:r,parameters:n}=Object.values(e).reduce(((e,r)=>{const n=r.name.toLowerCase();let a=t[n];return a&&a.type===r.type||(a={name:r.name,type:r.type}),a.value||(e.showParameters=!0),e.parameters[n]=a,e}),{showParameters:!1,parameters:{}});F.setState({parameters:n}),r&&C.setState({showParameters:!0},!0);return!r}(e)){C.setState({reportErrors:null,isFetching:!0});try{const t=await async function(e){const{jql:t,fields:r}=I(e.fields),{$jira:n}=(0,y.f3)("JiraService");return(await n.searchTickets(t,r)).map((({id:e,key:t,fields:r})=>function(e){return e.worklog&&(e.worklog=e.worklog.worklogs),e.comment&&(e.comment=e.comment.comments),e}({...r,id:e,issuekey:t})))}(e),r={header:new Array(nt()).fill(null).map((()=>[])),body:[],footer:[]};!function(e,t){const{fields:r}=F.getState(),n=e.header.length;let a;r.forEach((r=>{r.colGroup?tt([r],e,t):a=Ke(r,a,e,n)}))}(r,t),et(r,t),C.setState({reportData:r,isFetching:!1},!0)}catch(r){let e=["Unknown error occurred while generating report. Look at console log for more details"];var t;if(400===r.status)e=(null===(t=r.error)||void 0===t?void 0:t.errorMessages)||e;console.error("Error generating pivot report:- ",r),C.setState({reportErrors:e,isFetching:!1},!0)}}}async function ct(e){const{id:t}=e,{$report:r}=(0,y.f3)("ReportService"),n=await r.saveQuery(e,!0);return t!==n&&r.getReportDefinition(n)}var ut=r(5937),dt=r(9230);const pt=function({title:e,onBackClick:t,show:r,onHide:n,children:a,contentClassName:s,controls:i}){return(0,v.jsx)("div",{className:"side-bar-container "+(r?"open":"closed"),children:(0,v.jsxs)("div",{className:"site-bar-block",children:[(0,v.jsxs)("div",{className:"header"+(t?" ps-0":""),children:[(0,v.jsx)(o.zx,{className:"close-icon",icon:"fa fa-times",onClick:n,title:"Hide this block"}),i,t&&(0,v.jsx)(o.zx,{className:"back-icon float-start",icon:"fa fa-arrow-left",onClick:t,title:"Configure data source"}),(0,v.jsx)("h2",{className:"title",children:e})]}),(0,v.jsx)("div",{className:d()("site-bar-content",s),children:a})]})})};var mt=r(2371);const ft=function(){const e=qe((({fields:e})=>e));return a.useEffect((()=>{Oe()}),[]),(0,v.jsxs)("div",{className:"fields-collection",children:[(0,v.jsx)(ht,{}),(0,v.jsx)(mt.TabView,{children:e.map((e=>(0,v.jsx)(mt.TabPanel,{header:e.label,children:(0,v.jsx)(yt,{fields:e.items})},e.label)))})]})};function ht(){const{searchText:e,setSearchText:t}=S();return(0,v.jsxs)("div",{className:"search-container",children:[(0,v.jsx)("span",{className:"fa fa-search"}),(0,v.jsx)(o.zC,{value:e,placeholder:"type here to search for fields...",onChange:t})]})}function yt({fields:e}){var t,r;const n=null===(t=S((({searchText:e})=>e)))||void 0===t||null===(r=t.trim())||void 0===r?void 0:r.toLowerCase(),[s,i]=a.useState((()=>gt(e,n)));return a.useEffect((()=>{i(gt(e,n))}),[n,e,i]),(0,v.jsx)("div",{className:"fields-list",children:null===s||void 0===s?void 0:s.map(((e,t)=>(0,v.jsxs)(o._l,{className:"jira-field",itemType:"jira-field",item:e,children:[(0,v.jsx)("span",{className:"fa fa-copy float-end pointer",onClick:t=>function(e,t){var r;(0,k.sT)(e);const n=t.custom?t.name:t.key;null!==(r=navigator.clipboard)&&void 0!==r&&r.writeText&&navigator.clipboard.writeText(n)}(t,e),title:"Click to copy field for query filter"}),(0,v.jsx)("span",{children:e.name})]},t)))})}function gt(e,t){if(!t)return e;return e.filter((e=>e.name.toLowerCase().includes(t)||e.key.toLowerCase().includes(t)))}function vt({item:e},{index:t}){const r=R(e);F.setState((({fields:e})=>((e=[...e]).splice(t,0,r),{fields:e})))}function xt(e){F.setState((({fields:t})=>((t=[...t]).splice(e,1),{fields:t}))),T.setState({itemPath:null})}function bt(e,t){F.setState((({fields:r})=>((r=[...r])[t]=e,{fields:r})))}function jt(e){F.setState({fields:e})}const wt=function({item:e,index:t,depth:r,dragProps:n}){const s=a.useCallback((e=>{(0,k.sT)(e),xt(t)}),[t]),{itemPath:i,selectItem:o}=T(),l=a.useCallback((()=>o(`fields.${t}`,r)),[t,r,o]);return(0,v.jsx)("div",{className:"row-item"+(i?" selected":""),onClick:l,children:(0,v.jsxs)("div",{className:"row-config-head",ref:n.dragRef,children:[(0,v.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:s}),(0,v.jsx)("span",{className:"icon fa-solid fa-up-down-left-right"}),e.displayText||e.name]})})},kt=["jira-field"],Nt=[];function Ct(e){return{...e,subItems:[...e.subItems||[]]}}function St({path:e,item:t,depth:r,index:n,dragProps:s,removeItem:l,updateItem:c}){const u=a.useRef();a.useEffect((()=>{u.current={index:n,item:t,updateItem:c}}),[n,t,c]);const[p,m]=(0,i.Z)(!0),f=a.useCallback((({itemType:e,item:t},{index:r})=>{"jira-field"===e&&(t=R(t));const{item:n,index:a,updateItem:s}=u.current,i=Ct(n);i.subItems.splice(r,0,t),s(i,a)}),[]),h=a.useCallback((e=>{const{item:t,index:r,updateItem:n}=u.current,a=Ct(t);a.subItems.splice(e,1),n(a,r)}),[]),y=a.useCallback((()=>l(u.current.index)),[l]),g=a.useCallback(((e,t)=>{const{item:r,index:n,updateItem:a}=u.current,s=Ct(r);s.subItems[t]=e,a(s,n)}),[]),x=a.useCallback((e=>{const{item:t,index:r,updateItem:n}=u.current;n({...t,subItems:e},r)}),[]),{itemPath:b,selectItem:j}=T(),w=a.useCallback((t=>{(0,k.sT)(t),j(e,r)}),[e,r,j]),N=0===r||t.enableGrouping,C=d()("icon-col fa",{pointer:N,"fa-angle-down":N&&p,"fa-angle-right":N&&!p,"fa-arrow-right":!N});return(0,v.jsxs)("div",{className:"col-item"+(b===e?" selected":""),onClick:w,children:[(0,v.jsxs)("div",{className:"col-config-head",ref:s.dragRef,children:[(0,v.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:y}),N&&(0,v.jsx)("span",{className:"icon-pivot float-end fa-solid fa-table-columns me-2",title:"This field would be pivoted as column"}),(0,v.jsx)("span",{className:C,onClick:m}),t.displayText||t.name]}),p&&N&&(0,v.jsx)(o.bt,{addPlaceholder:!0,className:"sub-items",useDragRef:!0,items:t.subItems||Nt,accept:kt,defaultItemType:"col-sub-group",onDrop:f,onChange:x,placeholder:`Drag and drop sub group or value field for ${t.name}`,children:(t,n,{draggable:a})=>(0,v.jsx)(St,{path:`${e}.subItems.${n}`,index:n,depth:r+1,item:t,dragProps:a,removeItem:h,updateItem:g},n)})]})}const Ft=function({...e}){return(0,v.jsx)(St,{...e,removeItem:xt,updateItem:bt})};const Tt=function(){return(0,v.jsx)("div",{className:"pivot-config",children:(0,v.jsx)($t,{})})},At=["jira-field"],Et=(0,v.jsx)("span",{className:"p-3 block",children:"Drag and drop required fields from list to be shown in report"});function $t(){const e=F((({fields:e})=>e));return(0,v.jsxs)("div",{className:"fields-config",children:[(0,v.jsx)("strong",{children:"Report Fields"}),(0,v.jsx)(o.bt,{placeholder:Et,useDragRef:!0,items:e,accept:At,defaultItemType:"row-group",onDrop:vt,onChange:jt,children:(e,t,{draggable:r})=>e.colGroup?(0,v.jsx)(Ft,{item:e,index:t,dragProps:r,depth:0,path:`fields.${t}`},t):(0,v.jsx)(wt,{index:t,item:e,depth:0,dragProps:r},t)})]})}var Pt=r(825);const Rt=[{value:"days",label:"Days with Week"},{value:"week",label:"Week with Month"}];const It=function({isRow:e}){const t=qe((({fields:e})=>e)),r=a.useMemo((()=>t.map((({label:e,items:t})=>({label:e,items:t.filter((e=>{var t,r,n;return(null===(t=e.schema)||void 0===t||null===(r=t.type)||void 0===r?void 0:r.startsWith("date"))&&"date-range"!==(null===(n=e.schema)||void 0===n?void 0:n.type)}))})))),[t]);return(0,v.jsxs)("div",{className:"display-options",children:[(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Date Range:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Pt.I0,{field:"dateRange",range:!0})})]}),!e&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Range Type:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Pt.xw,{field:"rangeType",dataset:Rt,autoSelect:!0})})]}),(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Filter issues with:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Pt.xw,{field:"filterField",dataset:r,valueField:"key",optionLabel:"name",optionGroupLabel:"label",optionGroupChildren:"items",filter:!0,grouped:!0})})]})]})},Dt={any:function({item:e,isGrouped:t,isRow:r}){var n;if(t)return null;const a=function(e,t){return B.filter((r=>(!r.allowedFor||r.allowedFor.includes(e))&&(t||r.value!==z)))}(null===(n=e.schema)||void 0===n?void 0:n.type,r),s=(i=e.agrFunc)&&H.includes(i);var i;return(0,v.jsxs)("div",{className:"display-options",children:[(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Aggregation:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Pt.xw,{field:"agrFunc",dataset:a,autoSelect:!0})})]}),s&&(0,v.jsx)("div",{className:"label-value-pair",children:(0,v.jsx)(Pt.z8,{field:"useDistinct",label:"Use distinct values only",disabled:!0})})]})},"date-range":It};const Gt=function({filterText:e}){return(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Filter Query:"}),(0,v.jsx)(Pt.yi,{className:"w-100",field:"filter",multiline:!0}),(0,v.jsx)(Lt,{filterText:e})]})};function Lt({filterText:e}){const[t,r]=a.useState({}),n=qe((e=>e.fieldsMap)),s=a.useRef(n);return s.current=n,a.useEffect((()=>{if(null!==e&&void 0!==e&&e.trim()){const t={fieldsMap:s.current,fields:{},parameters:{}};r(ye(e,t))}else r({})}),[e,r]),t.isValid?null:(0,v.jsx)("div",{className:"msg-error",children:t.errorMessage})}const Mt=function({selection:e}){const{itemPath:t,item:r,isRow:n,level:s,selectItem:i}=e,l=a.useCallback((()=>i()),[i]);if(!r)return null;const c=r.enableGrouping||!n&&0===s,u=Dt[r.schema.type]||Dt.any;return(0,v.jsxs)("div",{className:"item-properties",children:[(0,v.jsx)(o.zx,{icon:"fa fa-times",className:"float-end",onClick:l}),(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Field name:"}),(0,v.jsx)("span",{className:"prop-value",children:r.name})]}),(0,v.jsx)(Pt.l0,{value:r,onChange:A,args:{itemPath:t,isRow:n},children:(0,v.jsxs)("div",{className:"config-props",children:[!s&&(0,v.jsx)(Pt.z8,{field:"colGroup",label:"Make this a column group field"}),(n||!!s)&&(0,v.jsx)(Pt.z8,{label:"Enable grouping",field:"enableGrouping"}),(n||!c)&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Header text"})," ",(0,v.jsx)(Pt.yi,{field:"headerText",maxLength:35,placeholder:r.name||"Custom header text for column"})]}),c&&(0,v.jsx)(Pt.z8,{className:"inline-block",label:"Show totals",field:"showTotal"}),c&&(0,v.jsx)(Pt.lA,{className:"inline-block btn-sm float-end",onLabel:"At beginning",offLabel:"At end",field:"showTotalAtBeginning",disabled:!r.showTotal}),u&&(0,v.jsx)(u,{item:r,isGrouped:c,isRow:n}),c&&(0,v.jsx)(Gt,{filterText:r.filter})]})})]})};var Ut=r(218),qt=r(9110),Ot=r(6552);const zt=function({reportId:e}){const t=(0,s.s0)(),[r,n]=(0,i.Z)(!1),l=a.useCallback((async()=>{e?await function(){const{hasChanges:e,...t}=F.getState();return ct(t)}():n()}),[e,n]),c=a.useCallback((()=>{!function(e){const{id:t,queryName:r,createdBy:n}=F.getState();Ot.Z.confirmDelete(`Are you sure to delete the report named "${r}" permanently?`).then((()=>{const{$report:a,$message:s,$analytics:i}=(0,y.f3)("ReportService","MessageService","AnalyticsService");a.deleteSavedQuery(t).then((t=>{s.success(`Pivot report "${r}" deleted successfully`),i.trackEvent("Pivot Report Deleted"),e(n)}))}))}((e=>{t(`/${e}/reports/pivot`)}))}),[t]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"controls float-end",children:[!!e&&(0,v.jsx)(o.zx,{icon:"fa fa-trash",className:"mx-1",severity:"danger",onClick:c,title:"Delete this report"}),(0,v.jsx)(o.zx,{icon:"fa fa-save",className:"mx-1",onClick:l,title:"Save this report"}),!!e&&(0,v.jsx)(o.zx,{icon:"fa fa-copy",className:"mx-1",onClick:n,title:"Rename report or save as new report"})]}),r&&(0,v.jsx)(qt.Z,{allowCopy:!!e,onHide:n,onChange:async(e,r)=>{const a=await function(e,t){const{hasChanges:r,...n}=F.getState();return n.queryName=e,t&&delete n.id,ct(n)}(e,r);if(n(),a){const{id:e,createdBy:r}=a;t(`/${r}/reports/pivot/${e}`)}}})]})};const Bt=function({show:e,onHide:t,reportId:r}){const[n,a]=(0,i.Z)(!r),s=(0,v.jsx)(zt,{reportId:r,onToggleDataSource:a});return(0,v.jsx)(pt,{show:e,onHide:t,title:"Report Config",onBackClick:n?void 0:a,controls:s,width:"500",contentClassName:"p-0",children:(0,v.jsx)("div",{className:"editor-controls",children:n?(0,v.jsx)(Ht,{onDone:a}):(0,v.jsx)(Vt,{})})})};function Ht({onDone:e}){const{jql:t,dataSourceType:r}=F((({jql:e,dataSourceType:t})=>({jql:e,dataSourceType:t})));return(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("p",{children:"Select a data source option for retrieving a list of issues. You have the choice of utilizing direct Jira Query Language (JQL) queries or extracting a list of issues based on a specific sprint and subsequently applying a JQL filter to refine the results."}),(0,v.jsx)("label",{className:"font-bold mt-3",children:"Data source type:"}),(0,v.jsx)(dt.EU,{className:"block",value:r,defaultValue:1,label:"Use raw JQL to filter and pull issues list",onChange:P}),(0,v.jsx)(dt.EU,{className:"block",value:r,defaultValue:2,label:"Pull issues for select sprints and apply JQL filter",onChange:P}),(0,v.jsx)("label",{className:"font-bold mt-3",children:"JQL Query:"}),(0,v.jsx)(Ut.Z,{jql:t,plugged:!0,onChange:$}),(0,v.jsx)(o.zx,{className:"float-end me-2",icon:"fa fa-arrow-right",iconPos:"right",label:"Select fields",disabled:2!==r&&(null===t||void 0===t?void 0:t.length)<5,onClick:e,title:"Configure data source"})]})}function Vt(){const e=function(){const{itemPath:e,level:t,selectItem:r}=T(),n=F((t=>e?(0,k.aM)(t,e):null));if(!n)return{};const a=!n.colGroup&&!t;return{item:n,itemPath:e,isRow:a,level:t,selectItem:r}}(),t=!(null===e||void 0===e||!e.item);let r=(0,v.jsxs)("div",{className:"field-config",children:[(0,v.jsx)(Tt,{}),(0,v.jsx)(ft,{})]});return t&&(r=(0,v.jsxs)(ut.q,{style:{height:"100%"},layout:"vertical",children:[(0,v.jsx)(ut.E,{style:{height:"10%"},children:r}),(0,v.jsx)(ut.E,{style:{height:"5%"},children:(0,v.jsx)(Mt,{selection:e})})]})),(0,v.jsx)("div",{className:"controls",children:r})}var Qt=r(1329);const Wt=function(){const e=F((({queryName:e})=>e)),t=C((({reportData:e})=>e));return(0,v.jsx)("div",{className:"group-table-container",children:(0,v.jsxs)(Qt.TT,{className:"group-table table-bordered",exportSheetName:e,children:[(0,v.jsx)(Jt,{rows:t.header,tag:Qt.Et,isHeader:!0}),(0,v.jsx)(Jt,{rows:t.body,tag:Qt.XP})]})})};function Jt({tag:e,isHeader:t,rows:r}){return(0,v.jsx)(e,{children:r.map(((e,r)=>(0,v.jsx)(_t,{isHeader:t,cells:e},r)))})}function _t({isHeader:e,cells:t}){return(0,v.jsx)("tr",{children:t.map(((t,r)=>(0,v.jsx)(Zt,{isHeader:e,cell:t},r)))})}function Zt({isHeader:e,cell:t}){const r=e?"th":"td",{value:n,headerText:a,tagProps:s,renderer:{Component:i,props:o}={}}=t;if(i)return(0,v.jsx)(i,{...o,value:n,tag:r,tagProps:s});{const t=(e?a:n)||" ";return(0,v.jsx)(r,{...s,children:t})}}var Yt=r(3682);const Xt=function(){return(0,v.jsx)("div",{className:"pad-15",children:(0,v.jsxs)("section",{children:[(0,v.jsx)("h2",{children:"How to Use the Pivot Report"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"Start by providing a JQL query to filter data from Jira."}),(0,v.jsx)("li",{children:"Easily customize your report by dragging and dropping fields from the right corner into the Report Fields section."}),(0,v.jsx)("li",{children:"You have the flexibility to display data as regular rows with grouping or mark specific fields as column groups for a column-based layout."}),(0,v.jsx)("li",{children:"Utilize Column Groups to organize and present your data in columns, offering a structured view of your information."}),(0,v.jsx)("li",{children:"Make use of subgroups and filters within column groups to further refine your report's content."}),(0,v.jsx)("li",{children:"To preview your report, simply click on the preview icon located at the top of the report interface."})]}),(0,v.jsxs)("p",{children:["To know more about Pivot report, have a look at ",(0,v.jsx)(o.rU,{href:`${Yt.ov}/features/reports/pivot`,children:"documentation"})]}),(0,v.jsxs)("p",{children:["To report a bug or suggest improvements to the report, visit ",(0,v.jsx)(o.rU,{href:`${Yt.zv}/discussions/329`,children:"GitHub discussions"})]}),(0,v.jsx)("h2",{children:"Upcoming Enhancements"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"The ability to sort the data under each group."}),(0,v.jsx)("li",{children:"More formatting option for fields like timestamp, date time, etc.."}),(0,v.jsx)("li",{children:"The ability to display totals for each group, offering a more comprehensive view of your data."}),(0,v.jsx)("li",{children:"Support for utilizing parent, sub-tasks and linked issues, allowing you to explore relationships and dependencies within your data."}),(0,v.jsx)("li",{children:"Enhanced support for pulling issues based on sprints, in addition to JQL queries, for a more dynamic reporting experience."})]}),(0,v.jsx)("h2",{children:"Future Enhancements"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"Enhanced support for adding the Pivot Report as a gadget on your dashboard, providing seamless integration with your Jira workflow."}),(0,v.jsx)("li",{children:"Exciting new features, including the option to add chart views based on your data, enabling richer data visualization."})]}),(0,v.jsx)("br",{}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:"Please Note:"})," This report is currently undergoing development and is not yet considered fully operational. We strongly request you to manually validate the output before using it for any business purpose. If you encounter any unexpected errors or if the output does not align with your expectations, we kindly request that you report the issue to us. Your assistance in improving the report's reliability is greatly appreciated."]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:"When reporting issues"}),", we kindly ask you to provide the following details:"]}),(0,v.jsxs)("ol",{children:[(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Screenshots:"})," Include screenshots that illustrate the problem or discrepancies you've encountered. Visual aids can significantly assist us in identifying issues."]}),(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Console Error Logs:"})," If applicable, please provide any error messages or console logs related to the problem. These logs can offer valuable insights into the root cause of the issue."]}),(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Custom Fields:"})," If the issue pertains to specific custom fields, please specify the type of custom fields involved. This information can help us pinpoint and address field-specific challenges more effectively."]})]}),(0,v.jsx)("p",{children:"Your feedback and collaboration are instrumental in ensuring the quality and reliability of this report. We appreciate your patience and assistance as we work to enhance its performance."})]})]})})};const Kt=function(){const{hasReportData:e,reportErrors:t,isFetching:r,showParameters:n}=C((({reportData:e,reportErrors:t,isFetching:r,showParameters:n})=>({hasReportData:!!e,reportErrors:t,isFetching:r,showParameters:n})));return r?(0,v.jsx)("div",{className:"editor-body p-4",children:(0,v.jsx)("strong",{children:"Please wait while the data is being pulled from Jira. This may take a while depending on the number of issues being pulled."})}):(0,v.jsxs)("div",{className:"editor-body",children:[t&&(0,v.jsx)(er,{errors:t}),n&&(0,v.jsx)(tr,{}),e&&(0,v.jsx)(Wt,{}),!e&&!n&&(0,v.jsx)(Xt,{})]})};function er({errors:e}){return(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("h2",{children:"Report Definition Error"}),(0,v.jsx)("p",{children:"The report definition has one or more errors. Please fix it before you try to generate report"}),(0,v.jsx)("ul",{className:"msg-error",children:e.map(((e,t)=>(0,v.jsx)("li",{children:e},t)))})]})}function tr(){const e=F((({parameters:e})=>e)),t=Object.keys(e);return(0,v.jsx)(Pt.l0,{value:e,onChange:E,children:(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("strong",{children:"Provide values for missing parameters to generate report:"}),(0,v.jsx)("br",{}),t.map((t=>(0,v.jsxs)("div",{className:"param-field py-3",children:[(0,v.jsxs)("label",{className:"font-bold me-3",children:[e[t].name,": "]}),(0,v.jsx)(rr,{type:e[t].type,name:e[t].name})]},t))),(0,v.jsx)("br",{}),(0,v.jsx)(dt.zx,{icon:"fa fa-refresh",label:"Generate Report",onClick:lt})]})})}function rr({type:e,name:t}){const r=`${t}.value`;switch(e){default:return(0,v.jsx)(Pt.yi,{field:r});case"daterange":return(0,v.jsx)(Pt.I0,{field:r,range:!0});case"datetime":return(0,v.jsx)(Pt.I0,{field:r,showTime:!0});case"date":return(0,v.jsx)(Pt.I0,{field:r,showTime:!1});case"usergroup":return(0,v.jsx)("span",{className:"link",children:"Select users"})}}const nr=function(){const{reportId:e}=(0,s.UO)(),[t,r]=(0,i.Z)(!e);a.useEffect((()=>{!async function(e){if(!e)return F.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),void C.setState({},!0);const{$report:t}=(0,y.f3)("ReportService"),r=await t.getReportDefinition(e),{$message:n}=(0,y.f3)("MessageService");r?"pivot"!==r.reportType?(F.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report "${r.queryName}" is not a valid Pivot Report.`,"Report Incompatible")):F.setState(r,!0):(F.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report id "${e}" is invalid or the report has been deleted.`,"Report Not Found"))}(e)}),[e]);const n=C((({isFetching:e})=>e)),l=F((({queryName:e})=>e)),c=(0,v.jsx)(o.zx,{type:"secondary",icon:"fa fa-edit",className:"mx-1",onClick:r,title:"Edit report definition"});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Bt,{reportId:e,show:t,onHide:r}),(0,v.jsx)("div",{className:"page-container",children:(0,v.jsx)(x,{title:l?`${l} - [Pivot report]`:"Pivot report",isGadget:!1,isLoading:n,customActions:c,onRefresh:lt,children:(0,v.jsx)(Kt,{})})})]})}}}]);