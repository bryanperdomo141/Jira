"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[402],{5960:(e,t,r)=>{r.d(t,{c:()=>i});r(9584);var n=r(1814),s=r(9640),a=r(7884);class o extends n.c{constructor(e){super(e,"Save Report As"),this.nameChanged=e=>this.setState({newQueryName:e}),this.copyChanged=e=>this.setState({copyQuery:e}),this.done=()=>{const{newQueryName:e,copyQuery:t}=this.state;this.props.onChange(e,t)},this.style={width:"350px"},this.state={showDialog:!0,newQueryName:e.queryName||"",copyQuery:!1}}getFooter(){const{state:{newQueryName:e}}=this;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.q,{text:!0,type:"secondary",label:"Cancel",onClick:this.onHide}),(0,a.jsx)(s.q,{type:"primary",icon:"fa fa-save",label:"Save",disabled:!e||e.length<3,onClick:this.done})]})}render(){const{props:{allowCopy:e},state:{newQueryName:t,copyQuery:r}}=this;return super.renderBase((0,a.jsxs)("div",{className:"pad-15",children:[(0,a.jsx)("label",{children:"Report Name"}),(0,a.jsx)("div",{children:(0,a.jsx)(s.SC,{value:t,onChange:this.nameChanged,style:{width:"100%"}})}),e&&(0,a.jsx)("div",{children:(0,a.jsx)(s.yw,{checked:r,onChange:this.copyChanged,label:"Save as new report"})})]}))}}const i=o},402:(e,t,r)=>{r.r(t),r.d(t,{default:()=>fr});var n={};r.r(n),r.d(n,{as_date:()=>qe,avg:()=>Oe,currentUser:()=>Re,date_diff:()=>_e,first:()=>He,last:()=>Qe,max:()=>Ve,min:()=>Be,now:()=>Me,parameters:()=>$e,sum:()=>Ue,today:()=>Le,todayEOD:()=>De});var s=r(9584),a=r(3424),o=r(8508),i=r(9640),l=r(8032),c=r(8516),u=r(6736),d=r.n(u),p=r(5068),m=r(8756),f=r(3e3),h=r(8271),y=r(4324),g=r(4568),v=(r(1082),r(7884));const x=function(e){const{title:t,iconClass:r,hideRefresh:n,gadgetHint:a,hideMenu:o,isLoading:u,customActions:m,onRefresh:f,settings:g}=e,x=s.useRef({}),w=!1!==e.isGadget,j=g||{fullWidth:!1,fullHeight:!1},[k,N]=(0,s.useState)(j.fullWidth||!1),[S,C]=(0,s.useState)(j.fullHeight||!1),[T,F]=(0,s.useState)(!1),A=s.useId();(0,s.useEffect)((()=>{g&&(N(g.fullWidth),C(g.fullHeight))}),[g]);const{$analytics:E}=(0,y.uU)("AnalyticsService"),P=()=>{F(!T),T?document.body.classList.remove("fs-layout"):document.body.classList.add("fs-layout")},I=(t,r)=>{e.onAction&&e.onAction({type:t,data:r},e.model,e.index)};x.current.props=e,x.current.isGadget=w,x.current.fullWidth=k,x.current.fullHeight=S,x.current.isFullScreen=T,x.current.$analytics=E,x.current.setSizeOptions=(e,t)=>{j.fullWidth=e,j.fullHeight=t,N(e),C(t),R()},x.current.toggleFullScreen=P,x.current.performAction=I;const R=()=>{I(h.s.SettingsChanged,j)},$=e=>(0,p._A)(e,b(x.current)),G=s.useCallback((e=>(0,p._A)(e,b(x.current))),[]),{children:q,tabLayout:L,gadgetType:D}=e;if(L)return(0,v.jsx)(v.Fragment,{children:q});const M=k||!w,_=S||!w,U=d()("gadget",e.className,{docked:!w,"full-width":M&&!T,"full-height":_&&!T,"half-width":!M&&!T,"half-height":!_&&!T,"full-screen":T});return(0,v.jsxs)("div",{ref:t=>{x.current.rootEl=t;const{dropProps:{dropConnector:r}={}}=e;r&&r(t)},className:U,"data-test-id":D,children:[u&&(0,v.jsx)(i.c1,{}),(0,v.jsx)(l.Panel,{header:(()=>{const{subTitle:s,draggableHandle:l}=e,d="gadget-header"+(l?" movable":"");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{ref:l,className:d,onContextMenu:w?$:null,onDoubleClick:P,children:[(0,v.jsx)("i",{className:`fa ${r}`})," ",t," ",s&&(0,v.jsxs)("span",{children:[" - ",s]}),(0,v.jsxs)("div",{className:"float-end",children:[a?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.o,{target:`.icon-hint-${A}`,children:a}),(0,v.jsx)("i",{className:`fa fa-info-circle icon-hint icon-hint-${A}`,"data-pr-position":"bottom"})]}):null,m,!n&&(0,v.jsx)(i.q,{text:!0,icon:"fa fa-refresh",disabled:u,onClick:p||f,title:"Refresh data"}),!o&&(0,v.jsx)(i.q,{text:!0,icon:"fa fa-wrench",onClick:G})]})]}),(0,v.jsx)("div",{className:"clearfix"})]});var p})(),children:q})]})};function b(e){const{$analytics:t,performAction:r,isGadget:n,isFullScreen:s,fullWidth:a,fullHeight:o,rootEl:i,setSizeOptions:l,toggleFullScreen:c,props:{title:u,hideExport:d,hideCSVExport:p,hideXLSXExport:m,hidePDFExport:y}}=e,v=n?[{separator:!0},{label:"Full width",icon:`fa fa-${a?"check-":""}circle fs-16 margin-r-5`,command:()=>l(!a,o)},{label:"Full height",icon:`fa fa-${o?"check-":""}circle fs-16 margin-r-5`,command:()=>l(a,!o)},{separator:!0},{label:"Remove",icon:"fa fa-remove",command:()=>{t.trackEvent("Gadget removed",g.HG.GadgetActions,u),r(h.s.RemoveGadget)}}]:[],x=[];return d||(x.push({separator:!0}),p||x.push({label:"Export to CSV",icon:"fa fa-file-text",command:()=>w(f.s.CSV,u,i,t)}),m||x.push({label:"Export to Excel",icon:"fa fa-file-excel",command:()=>w(f.s.XLSX,u,i,t)}),y||x.push({label:"Export to PDF",icon:"fa fa-file-pdf",command:()=>w(f.s.PDF,u,i,t)})),[{label:"Toggle full screen",icon:"fa fa-"+(s?"compress":"expand"),command:()=>c()},...x,...v]}function w(e,t,r,n){const s=new m.q;s.fileName=t,s.format=e||e,s.element=r,n.trackEvent("Export data",g.HG.GadgetActions,s.format),s.export()}var j=r(40),k=r(9672),N=r(6044);const S=(0,N.Su)((()=>({showParameters:!1,isFetching:!1}))),C=(0,N.Su)((e=>({searchText:"",setSearchText:t=>e({searchText:t})}))),T=(0,N.Su)((()=>({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]}))),F=(0,N.Su)((e=>({itemPath:null,level:0,selectItem:(t,r)=>e({itemPath:t,level:r})})));function A(e,t,{args:{itemPath:r}}){const n=T.getState(),s=(0,j.S)(n,r,e),{fields:a}=s;T.setState({fields:a})}function E(e={}){T.setState({parameters:e})}function P(e){T.setState((()=>({jql:e})))}function I(e){T.setState((()=>({dataSourceType:e||1})))}function R(e){const{id:t,key:r,name:n,schema:s}=e;return{id:t,key:r,name:n,schema:s}}function $(e={}){const{jql:t,fields:r}=T.getState();return G(e,r),{jql:t,fields:Object.keys(e)}}function G(e,t){t&&t.forEach((t=>{var r;null!==(r=t.schema)&&void 0!==r&&r.derived&&t.key.includes(".")?e[t.key.split(".")[0]]=!0:t.key&&(e[t.key]=!0),G(e,t.subItems)}))}var q=r(1916);const L=[{label:"Default",value:"DT_DF",props:void 0,type:"datetime"},{label:"Date only",value:"DT_DO",props:{dateOnly:!0},type:"datetime"},{label:"Age in days (words)",value:"DT_AG",props:{quick:!0},type:"datetime"},{label:"Age in days (number)",value:"DT_NM",props:{format:"num"},type:"datetime"},{label:"Issue Key with Status",value:"PT_KY_ST",props:{settings:{showStatus:!0}},type:"parent"},{label:"Issue Key only",value:"PT_KY",props:{settings:{showStatus:!1}},type:"parent"},{label:"Summary only",value:"PT_SM",props:{settings:{valueType:"summary",showStatus:!1}},type:"parent"},{label:"Summary with Status",value:"PT_SM_ST",props:{settings:{valueType:"summary",showStatus:!0}},type:"parent"},{label:"Both Key & Summary",value:"PT_BT",props:{settings:{valueType:"both",showStatus:!1}},type:"parent"},{label:"Key, Summary & Status",value:"PT_BT_ST",props:{settings:{valueType:"both",showStatus:!0}},type:"parent"},{label:"Key only",value:"PR_KY",props:{settings:{}},type:"project"},{label:"Name only",value:"PR_NM",props:{settings:{valueType:"name"}},type:"project"},{label:"Both Key & Name",value:"PR_BT",props:{settings:{valueType:"both"}},type:"project"},{label:"Formatted",value:"TS_FR",props:{format:!0},type:"timespent"},{label:"As Number",value:"TS_NM",props:{format:!1},type:"timespent"},{label:"Name only",value:"USR_NM",props:{settings:{showImage:!1}},type:"user"},{label:"Name with Image",value:"USR_NM_IMG",props:{settings:{showImage:!0}},type:"user"},{label:"Email only",value:"USR_EM",props:{settings:{valueType:"email",showImage:!1}},type:"user"},{label:"Email with Image",value:"USR_EM_IMG",props:{settings:{valueType:"email",showImage:!0}},type:"user"},{label:"Name & Email",value:"USR_BT",props:{settings:{valueType:"both",showImage:!1}},type:"user"},{label:"Name, Email & Image",value:"USR_BT_IMG",props:{settings:{valueType:"both",showImage:!0}},type:"user"}],D=L.reduce(((e,t)=>(e[t.value]=t.props,e)),{}),M=L.groupBy((e=>e.type)).reduce(((e,{key:t,values:r})=>(e[t]=r,e)),{});function _(e){const{schema:{type:t},format:r}=e,n=(0,q.Mx)(t),s=r&&D[r];return s&&(n.props=s),{renderer:n}}function U(e){const{keyField:t}=(0,q.YX)(e),{key:r}=e;return t?"function"===typeof t?e=>t(e[r]):t?e=>{var n;return null===(n=e[r])||void 0===n?void 0:n[t]}:e=>e[r]:e=>e[r]}function O(e,t){const{keyField:r}=(0,q.YX)(e),{key:n}=e;return function(e,t,r){const n=n=>function(e,t){if(!t)return e;if("function"===typeof t)return t(e);if("string"===typeof t)return null===e||void 0===e?void 0:e[t];throw new Error("Key field is of unknown type: "+typeof t)}((0,j.q)(n,e),t)===r;return n}(n,r,t)}function B(e){return t=>t.key===e}M.date=M.datetime;var V=r(4240);const H="none",Q=[{value:H,label:"No Aggregation",allowDistinct:!0},{value:"sum",label:"Sum",allowedFor:["number","timespent","date","datetime"]},{value:"avg",label:"Avg",allowedFor:["number","timespent","date","datetime"]},{value:"min",label:"Min",allowedFor:["number","timespent","date","datetime"]},{value:"max",label:"Max",allowedFor:["number","timespent","date","datetime"]},{value:"count",label:"Count",returnType:"number",allowDistinct:!0},{value:"merge",label:"Merge (CSV)",allowedFor:["string"]},{value:"first",label:"First value"},{value:"last",label:"Last value"}],W=Q.filter((e=>e.allowDistinct)).map((e=>e.value));const J={count:function(e,t){return t.map((0,V.e)(e)).filter((e=>e||0===e)).length},merge:function(e,t){return t.map((0,V.e)(e)).join(", ")},first:function(e,t){return(0,j.q)(t[0],e)},last:function(e,t){return(0,j.q)(t.last(),e)}};function z(e){const{agrFunc:t="first"}=e;return!(!t||t===H)}function K(e,t){if(!z(e))return null;const{agrFunc:r="first"}=e,n=J[r];return n?n(e.key,t,e):t[r](e.key)}var Y=r(3072),X=r.n(Y);const Z=function(e){const{value:t,tagProps:r={}}=e;return t?(0,v.jsxs)("th",{"data-test-id":t.prop,className:"day-head"+(t.isHoliday?" holiday":""),...r,children:[t.dateNum,(0,v.jsx)("br",{}),(0,v.jsx)("span",{className:"day-name",children:t.day})]}):null};var ee=r(4552);function te(e,t,r,n,s,a){const[o,i]=a(r,t,s,n);return o&&(e.tagProps.colSpan=o),e.subItems=i,e}function re({date:e}){return{start:(e=X()(e)).startOf("day").valueOf(),end:e.endOf("day").valueOf()}}function ne({start:e,end:t},r){if(r){if(r.includes(".")){const[n,s]=r.split(".");return r=>r.map((r=>{let a=r[n];return a?Array.isArray(a)&&(a=a.filter((r=>{const n=r[s];return!!n&&X()(n).isBetween(e,t,void 0,"[]")})),!a.length)?null:{...r,[n]:a}:null})).filter(Boolean)}return n=>n.filter((n=>{const s=n[r];return!!s&&X()(s).isBetween(e,t,void 0,"[]")}))}}function se(e,t,r,n,s,a){const o=ae[e.schema.type];if(o)return o(e,t,r,n,s,a);throw new Error(`Unknown field error. Type:-${e.schema.type}`)}const ae={"date-range":function(e,t,r,n,s,a){const{dateRange:o,rangeType:i="days",filterField:l,showTotal:c,showTotalFirst:u,subItems:d}=e,p=function(e,t){const{$userutils:r}=(0,y.uU)("UserUtilsService");return(0,ee.Oy)(e,t,r.isHoliday)}(o.fromDate,o.toDate),m=c&&{headerText:"Total",colGroup:!0,enableGrouping:!0,depth:n,tagProps:{rowSpan:2},transformFn:ne({start:X()(o.fromDate).startOf("day"),end:X()(o.toDate).endOf("day")},l)};if("days"===i){const e=(0,ee.kd)(p),{header:s}=t,o=s[n],i=s[n+1];m&&u&&o.push(te(m,t,d,n+1,r,a));const c=e.map((e=>{const s={headerText:e.display,colGroup:!0,enableGrouping:!0,depth:n,tagProps:{colSpan:0},transformFn:ne(e,l)};return o.push(s),s.subItems=e.values.map((e=>{const o={enableGrouping:!0,value:e,depth:n+1,tagProps:{},transformFn:ne(re(e),l),renderer:{Component:Z}};i.push(o);const[c,u]=a(d,t,r,n+1);return c?(o.tagProps.colSpan=c,s.tagProps.colSpan+=c):s.tagProps.colSpan+=1,o.subItems=u,o})),s}));return m&&!u&&o.push(te(m,t,d,n+1,r,a)),[p.length,c]}}};function oe(e,t){if(!t.length)return;const{agrFunc:r="first",key:n}=e;if(!r)return null;let s=[];if(!n.includes("."))throw new Error("Unhandled Error: Error Code:- CF_NO_DOT");{const[e,r]=n.split(".");s=t.flatMap((t=>{const{[e]:n}=t;return n?Array.isArray(n)?n.map((({[r]:e})=>e)):[n[r]]:[]}))}const a=ie[r];return a?a(s):s[r]()}const ie={count:function(e){return e.filter((e=>e||0===e)).length},merge:function(e){return e.join(", ")},first:function(e){return e[0]},last:function(e){return e.last()}};function le(e,t){const[r,...n]=t;return r.preGroupFilter&&(e=r.preGroupFilter(e)),r.colGroup?[ce(t,e)]:r.enableGrouping?function(e,t,r){return e.groupFn(t,((t,n)=>{const s={...e.cellProps,value:t};return r.length&&(s.subRows=le(n,r)),s}))}(r,e,n):r.agrFunc?function(e,t,r){const n=me(e,t);r.length&&(n.subRows=le(t,r));return[n]}(r,e,n):ue(e,t)}function ce(e,t){let r=t,n=null,s=t,a=null;return e.flatMap((e=>(e.transformFn&&n!==e.transformFn&&t.length?(n=e.transformFn,r=n(t,e),s=r):e.transformFn||(r=t),e.colGroupFn&&a!==e.colGroupFn?(a=e.colGroupFn,s=a(r,((e,t,r)=>({key:r,values:t})))):e.colGroupFn||(s=r),function(e,t){var r;const n=e.groupFilterFn?(null===(r=t.filter(e.groupFilterFn)[0])||void 0===r?void 0:r.values)||[]:t;return pe(e,n)}(e,s))))}function ue(e,t){let r=null;const n=[];for(const s of e){const e=[];for(let a=0;a<t.length;a++){const o=t[a];if(o.enableGrouping){const r=t.slice(a);e[e.length-1].subRows=le([s],r);break}const i=de(o,s);if(Array.isArray(i)){if(o.colGroup){e.push(...i);continue}r||(r=t.slice(a));const s=ue(i,r),l=e.length?e[e.length-1]:null;l?l.subRows=s:n.push(...s);break}e.push(i)}e.length&&n.push(e)}return n}function de(e,t){const r=!e.issueFilterFn||e.issueFilterFn(t);return pe(e,r?[t]:[])}function pe(e,t){return e.enableGrouping&&e.subItems?ce(e.subItems,t).flat():e.colGroup?me(e,t):function(e,t){var r;if(null!==(r=e.schema)&&void 0!==r&&r.derived){const r=function(e,t){const{key:r}=e;if(r.includes(".")){const[e,n]=r.split(".");return t.flatMap((t=>{const{[e]:r}=t;return r?Array.isArray(r)?r.map((r=>({...t,[e]:[r]}))):[r[n]]:[]}))}throw new Error("Unhandled Error: Error Code:- DF_NO_DOT")}(e,t);return r.length?1===r.length?{...e.cellProps,value:oe(e,r)}:r:{...e.cellProps,value:null}}return{...e.cellProps,value:K(e,t)}}(e,t)}function me(e,t){var r;const n=null!==(r=e.schema)&&void 0!==r&&r.derived?oe(e,t):K(e,t);return{...e.cellProps,value:n}}function fe(e,t){Array.isArray(e)?function(e,t){e.forEach((e=>he(e,t)))}(e,t):he(e,t)}function he(e,t){const{subRows:r,...n}=e,s=t.length,a=t[s-1],o=a.length;a.push(n),null!==r&&void 0!==r&&r.length&&r.forEach(((e,r)=>{r&&t.push([]),fe(e,t)}));const i=t.length-s+1;if(i>1&&(n.tagProps={rowSpan:i},o))for(let l=o-1;l>=0;l--){const e=a[l];e.tagProps?e.tagProps.rowSpan<i&&(e.tagProps.rowSpan=i):e.tagProps={rowSpan:i}}}var ye=r(8280),ge=r.n(ye);const ve="parameters",xe=[{name:ve,parameters:[{paramName:"paramName",type:"string"}],returns:["any"]},{name:"sum",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"avg",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"min",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"max",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"first",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"last",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"as_date",parameters:[{paramName:"value",type:["number","date","datetime","string"]},{paramName:"format",type:["string"],optional:!0}],returns:"datetime"},{name:"today",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"eod",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"startOfDay",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"now",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"date_diff",parameters:[{paramName:"date1",type:"datetime"},{paramName:"date2",type:"datetime"},{paramName:"unit",type:"string",optional:!0}],returns:"number"},{name:"startDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"endDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"currentUser",parameters:[],returns:"user"}].reduce(((e,t)=>(e[t.name.toLowerCase()]=t,e)),{});function be(e){var t,r,n;return null===(t=ge().parse(`select * from json where (${e})`).value)||void 0===t||null===(r=t.where)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.value}function we(e,t){try{return function(e,t){if(!e||"string"===typeof e||!Array.isArray(e))return{isValid:!1,errorMessage:"Query is incomplete"};try{const r=function(e,t){return e.forEach((e=>{if(!Ne[e.type])throw new Error("Query is incomplete. Missing comparison");je(e,t)})),t}(e,t);return{isValid:!0,json:e,result:r}}catch(r){return{errorMessage:r.message,json:e}}}(be(e),t)}catch(r){return{isValid:!1,errorMessage:r.message}}}function je(e,t,r){const{type:n,operator:s}=e,a=Se[n];if(!a)throw new Error(`Usage of ${s||n} is unsupported`);return function(e){let t=(null===e||void 0===e?void 0:e.type)||e;if(!t)return e;Array.isArray(t)?(t=t.map((e=>ke[e]||e)).distinct(),t.length<2&&(t=t[0])):"string"===typeof t&&(t=ke[t]||t);if(!t)return e;if("object"===typeof e&&!Array.isArray(e))return{...e,type:t};return t}(a(e,t,r))}const ke={date:"datetime"};const Ne={AndExpression:Ce,OrExpression:Ce,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:s}=e,a=je(r,t);if((s.includes("<")||s.includes(">"))&&!Pe(a,Te))throw new Error(`Incompatible types used with "${s}" comparer`);const o=je(n,t,{type:a});if(!Pe(a,o))throw new Error(`"${s}" comparison done between incompatible types`)},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:s}}=e,a=je(r,t);if(!Pe(a,Te))throw new Error("Incompatible types used with between predicate");const o=je(n,t,{type:a}),i=je(s,t,{type:a});if(!Pe(a,o)||!Pe(a,i)||!Pe(o,i))throw new Error("Between predicate used with in-compatible types")},LikePredicate:function(e,t){const{left:r,right:n}=e,s=je(r,t);if(Pe(s,Fe))throw new Error("Like comparison is used with incompatible types");const{type:a,value:o}=n;if("string"!==a.toLowerCase())throw new Error("Only string is supported on right hand side of Like predicate");if(!["*",".","%","_"].some((e=>o.includes(e))))throw new Error("The string in right hand side of Like predicate doesn't contain any expressions and would never be met. Either use some expression or use other operators");if(o.replace(/[%.*]/g,"").length<3)throw new Error("The string in right hand side of Like predicate is too short. Either use some expression or use other operators");if(!Pe(je(n,t,{type:s}),["string"]))throw new Error("Like comparison done between incompatible types")},InExpressionListPredicate:function(e,t){const{left:r,right:n}=e,s=je(r,t);!function(e,t,r){const{value:n}=e;1===n.length&&(r={...r,isArray:!0});for(const s of n){const e=je(s,t,r);if(!Pe(r.type,e))throw new Error("List contains in-compatible types")}}(n,t,{type:s})}},Se={...Ne,Identifier:function(e,t){const{value:r}=e;let n=r.toLowerCase();n.startsWith("`")&&(n=n.substring(1,n.length-1));const s=t.fieldsMap[n];if(!s)throw new Error(`Unknown field ${r}`);return t.fields[n]=!0,s.schema},FunctionCall:function(e,t,r){const{name:n,params:s}=e,a=n.toLowerCase(),o=xe[a];if(!o)throw new Error(`Unknown function ${n}`);let{returns:i}=o;const{parameters:l}=o,c=(null===l||void 0===l?void 0:l.length)||0;1===(null===s||void 0===s?void 0:s.length)&&null===s[0]&&s.splice(0,1);if((null===s||void 0===s?void 0:s.length)>c)throw new Error(`Expected ${(null===l||void 0===l?void 0:l.length)||0} arguments for function "${n}", but passed ${(null===s||void 0===s?void 0:s.length)||0}`);for(let u=0;u<c;u++){const e=l[u],r=s[u];if(!r&&!e.optional)throw new Error(`Missing arguments for function ${n}`);const a=je(r,t,e);if(!Pe(a,e.type))throw new Error(`Type mismatch for argument ${u+1} on ${n}`);i===`:${e.paramName}`&&(i=(null===a||void 0===a?void 0:a.type)||a)}if("string"===typeof i&&i.startsWith(":"))throw new Error(`Unknown return type ${i} for function ${n}`);return Ae(a,s,t,r),i},Number:Ee,String:Ee,Boolean:Ee,Null:Ee};function Ce(e,t){const{left:r,right:n}=e;je(r,t),je(n,t)}const Te=["number","date","datetime","timespent"];const Fe=["date","datetime","number","timespent"];function Ae(e,t,r,n){if(e===ve){var s;const e=t[0],a=e.type.toLowerCase();if("string"!==a)throw new Error(`Parameter name must be a string, but passed ${a}`);const o=e.value.substring(1,e.value.length-1);if(o.length<5)throw new Error("Parameter name is too short");if(o.length>27)throw new Error("Parameter name is too big");const i=o.toLowerCase(),l=r.parameters[i];if(l&&!Pe(n.type,l.type))throw new Error(`Parameter ${e.value} is used across incompatible types`);r.parameters[i]={name:o,type:(null===(s=n.type)||void 0===s?void 0:s.type)||n.type,isArray:n.isArray||void 0}}}function Ee(e){const{type:t}=e;return{type:t.toLowerCase()}}function Pe(e,t){return!(!e||!t)&&(e=Ie(e),t=Ie(t),!0===e||!0===t||e===t||("string"===e?!(!t.includes("string")&&t.includes("number")):"string"===t?!(!e.includes("string")&&e.includes("number")):e.some((e=>t.includes(e)))))}function Ie(e){if("object"===typeof e&&!Array.isArray(e)){const{type:t,compatibleTypes:r}=e;e=t,null!==r&&void 0!==r&&r.length&&(e=[...r,e])}if(!e||"null"===e||"any"===e)return!0;if("string"===e)return e;if(!Array.isArray(e)){if("any"===e)return!0;e=[e]}return!!e.includes("any")||e}function Re(){var e;const{$session:t}=(0,y.uU)("SessionService");return(0,k.Co)(null===(e=t.CurrentUser)||void 0===e?void 0:e.jiraUser)}function $e(e){var t;return Ge(null===(t=this.parameters[e.toLowerCase()])||void 0===t?void 0:t.value)}function Ge(e){return Array.isArray(e)?e.map(Ge):"string"===typeof e?e.toLowerCase():e}function qe(e,t){return X()(e,t).valueOf()}function Le(e){return X()(Me(e)).startOf("day").valueOf()}function De(e){return X()(Me(e)).endOf("day").valueOf()}function Me(e){e=function(e){if(!isNaN(e))return{amount:parseFloat(e),unit:"days"};const t=new RegExp("^([+-])(\\d*)(y|Q|M|w|d|h|m)$","g").exec(e);if(!t)return null;const[,r,n,s]=t;return{amount:parseInt(r+n),unit:s}}(e);let t=X()();return e&&(t=t.add(e.amount,e.unit)),t.valueOf()}function _e(e,t,r){X()(e).diff(t,r).valueOf()}function Ue(e){return 0}function Oe(e){return 0}function Be(e){return 0}function Ve(e){return 0}function He(e){return null}function Qe(e){return null}const We=(0,N.Su)((()=>({fields:[],fieldsMap:{}})));async function Je(){const e=await async function(){const{$jira:e}=(0,y.uU)("JiraService"),t=function(e){return e.filter(Ke).map((e=>{const{id:t,key:r,name:n,custom:s}=e;let{schema:a}=e;return a||(a={type:r}),{id:t,key:r,name:n,custom:s,schema:a}})).orderBy((e=>e.name))}(await e.getCustomFields()),r=[],n=[],s={};t.forEach((e=>{let t=e.key.toLowerCase();if(s[t]&&e.id&&(t=e.id.toLowerCase()),s[t]=e,e.custom){const t=e.name.toLowerCase();s[t]||(s[t]=e),n.push(e)}else r.push(e)}));const a=[{id:"attachmentAuthor",key:"attachment.author",name:"Attachment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"attachmentCreated",key:"attachment.created",name:"Attachment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"attachmentFileName",key:"attachment.filename",name:"Attachment File Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentType",key:"attachment.mimeType",name:"Attachment Mime Type",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentSize",key:"attachment.size",name:"Attachment Size",schema:{type:"size",derived:!0,isArray:!0}},{id:"commentAuthor",key:"comment.author",name:"Comment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentCreated",key:"comment.created",name:"Comment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"commentBody",key:"comment.body",name:"Comment Body",schema:{type:"string",derived:!0,isArray:!0}},{id:"commentUpdateAuthor",key:"comment.updateAuthor",name:"Comment Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentUpdated",key:"comment.updated",name:"Comment Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"componentsDescription",key:"components.description",name:"Component Description",schema:{type:"string",derived:!0,isArray:!0}},{id:"componentsName",key:"components.name",name:"Component Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"dateRange",key:"",name:"Date Range",schema:{type:"date-range",computed:!0,depth:1}},{id:"fixVersionsArchived",key:"fixVersions.archived",name:"Fix Version Archived",schema:{type:"bool",derived:!0,isArray:!0}},{id:"fixVersionsName",key:"fixVersions.name",name:"Fix Version Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"fixVersionsReleaseDate",key:"fixVersions.releaseDate",name:"Fix Version Release Date",schema:{type:"date",derived:!0,isArray:!0}},{id:"fixVersionsReleased",key:"fixVersions.released",name:"Fix Version Released",schema:{type:"bool",derived:!0,isArray:!0}},{id:"worklogAuthor",key:"worklog.author",name:"Worklog Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogCreated",key:"worklog.created",name:"Worklog Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogComment",key:"worklog.comment",name:"Worklog Comment",schema:{type:"string",derived:!0,isArray:!0}},{id:"worklogTime",key:"worklog.started",name:"Worklog Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogTimespent",key:"worklog.timeSpentSeconds",name:"Worklog Time spent",schema:{type:"timespent",derived:!0,isArray:!0}},{id:"worklogUpdateAuthor",key:"worklog.updateAuthor",name:"Worklog Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogUpdated",key:"worklog.updated",name:"Worklog Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}}].orderBy((e=>e.name));return a.forEach((e=>{let{key:t}=e;t&&(s[t]&&(t=e.id),s[t.toLowerCase()]=e)})),{native:r,custom:n,derived:a,fieldsMap:s}}();We.setState({fields:[{label:"Native",items:e.native},{label:"Custom",items:e.custom},{label:"Derived",items:e.derived}],fieldsMap:e.fieldsMap})}const ze=["worklog","comment","attachment"];function Ke(e){return!ze.includes(e.key)}const Ye={parent:["key","id"],project:["name","key"],user:["displayName","emailAddress","name","accountId"]};const Xe={parent:["key"],project:["name","key"],user:["displayName","emailAddress","name","accountId"]};const Ze=Object.keys(n).reduce(((e,t)=>(e[t.toLowerCase()]=n[t],e)),{});function et(e){if(null===e||void 0===e||!e.trim())return;const{fieldsMap:t}=We.getState(),{parameters:r={}}=T.getState(),n={fieldsMap:t,parameters:r},s=be(e);return e=>e.map(function(e,t){const r=e.map((e=>tt(e,t)));return e=>r.reduce(((e,t)=>e&&t(e)),e)}(s,n)).filter(Boolean)}function tt(e,t){return(0,rt[e.type])(e,t)}const rt={AndExpression:nt,OrExpression:nt,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:s}=e,a=tt(r,t),o=tt(n,t);let i;i=a.returnsArrayOfValues?st(s,a,o):o.returnsArrayOfValues?st(s,o,a):function(e,t,r){switch(e){case"=":return e=>t(e)===r(e);case"!=":case"<>":return e=>t(e)!==r(e);case">":return e=>t(e)>r(e);case">=":return e=>t(e)>=r(e);case"<":return e=>t(e)<r(e);case"<=":return e=>t(e)<=r(e)}}(s,a,o);return e=>e&&i(e)?e:void 0},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:s}}=e,a=tt(r,t),o=tt(n,t),i=tt(s,t);return e=>{const t=a(e);return t>=o(e)&&t<=i(e)}},InExpressionListPredicate:function(e,t){const{left:r,right:n,hasNot:s}=e,a=tt(r,t);return function(e,t,r,n){var s;const{value:a}=e;let o=a.map((e=>tt(e,t)));1===o.length&&"parameters"===(null===(s=a[0].name)||void 0===s?void 0:s.toLowerCase())&&"FunctionCall"===a[0].type&&(o=o[0]());return r.returnsArrayOfValues?e=>{const t=r(e);for(let r of o)if("function"===typeof r&&(r=r(e)),t.includes(r))return n?null:e;if(n)return e}:e=>{const t=r(e);for(const r of o)if(t===r(e))return n?null:e;if(n)return e}}(n,t,a,!!s)},LikePredicate:function(e,t){t={...t,isLikeComparison:!0};const{left:r,right:n,hasNot:s}=e,a=tt(r,t);return function(e,t,r,n){let{value:s}=e;return s=s.substring(1,s.length-1),s=new RegExp(`^${s.replace(/%/g,".*").replace(/_/g,".")}$`,"im"),r.returnsArrayOfValues?e=>r(e).some((e=>s.test(e)))?n?null:e:n?e:void 0:e=>s.test(r(e))?n?null:e:n?e:void 0}(n,0,a,!!s)},Identifier:function(e,t){const{value:r}=e,n=r.toLowerCase(),s=t.fieldsMap[n],a=t.isLikeComparison?function(e){return(0,q.wn)(e,Xe,"name")}(s):function(e){return(0,q.wn)(e,Ye,["name","id"])}(s),{type:o,keyField:i}=a,l=s.key;let c=at;"date"!==o&&"datetime"!==o||(c=ot);return i?Array.isArray(i)?(c=e=>{if(!e)return null;const t=e[l];return"object"!==typeof t?t:i.map((e=>{var r;return null!==(r=at(t[e]))&&void 0!==r?r:{}}))},c.returnsArrayOfValues=!0,c):"function"===typeof i?e=>{const t=null===e||void 0===e?void 0:e[l];return t&&c(i(t))}:e=>{var t;return c(null===e||void 0===e||null===(t=e[l])||void 0===t?void 0:t[i])}:e=>c(null===e||void 0===e?void 0:e[l])},FunctionCall:function(e,t){const{name:r,params:n}=e,s=r.toLowerCase(),a=Ze[s];1===(null===n||void 0===n?void 0:n.length)&&null===n[0]&&n.splice(0,1);const o=n.map((e=>tt(e,t)));if(null!==o&&void 0!==o&&o.length&&o.some((e=>!e.isStaticValue)))return e=>e&&a.apply(t,o.map((t=>t(e))));{const e=a.apply(t,o.map((e=>e()))),r=()=>e;return a.isStaticValue=!0,r}},Number:it,String:it,Boolean:it,Null:it};function nt(e,t){const{left:r,right:n,operator:s}=e,a=tt(r,t),o=tt(n,t);return"and"===s?e=>a(e)&&o(e):e=>a(e)||o(e)}function st(e,t,r){switch(e){case"=":return e=>t(e).includes(r(e));case"!=":case"<>":return e=>!t(e).includes(r(e))}}function at(e){return"string"===typeof e?e.toLowerCase():null!==e&&void 0!==e?e:null}function ot(e){return e?X()(e).valueOf():e}function it(e){const{type:t,value:r}=e;let n=r;switch(t.toLowerCase()){case"string":n=at(r.substring(1,r.length-1));break;case"number":n=Number(r);break;case"boolean":n=Boolean(r);break;case"null":n=null;break;default:n=at(r)}const s=()=>n;return s.isStaticValue=!0,s}function lt(e){var t;return null!==(t=e.schema)&&void 0!==t&&t.derived?function(e){if(e.key.includes(".")){const[t,r]=e.key.split("."),n=U({key:r,schema:e.schema});return(e,s)=>{const a={};for(const o of e){const e=o[t];Array.isArray(e)&&e.groupBy(n).forEach((({key:e,values:n})=>{let s=a[e];s||(s={key:e,value:n[0][r],issuesMap:{}},a[e]=s);let i=s.issuesMap[o.issuekey];if(i){const e=i[t];n.forEach((t=>e.push(t)))}else i={...o,[t]:n},s.issuesMap[o.issuekey]=i}))}return Object.values(a).map((({key:e,value:t,issuesMap:r})=>s(t,Object.values(r),e)))}}}(e):function(e){const t=U(e);return(r,n)=>r.groupBy(t).map((({key:t,values:r})=>n(r[0][e.key],r,t)))}(e)}function ct(e,t,r,n){return t=function(e,t,r){var n;const{id:s,key:a,name:o,headerText:i=o,enableGrouping:l,agrFunc:c,...u}=e,d={id:s,key:a,tagProps:t,headerText:i||o,cellProps:_(e),...u};c&&z(e)&&(d.agrFunc=c);l&&(!r||r.enableGrouping||null!==(n=e.schema)&&void 0!==n&&n.isArray)&&(d.enableGrouping=!0,d.groupFn=lt(e),d.preGroupFilter=et(e.filter));return d}(e,{rowSpan:n},t),r.header[0].push(t),t}function ut(e,t){const{header:r}=e,[n]=r,s=le(t,n);e.body=function(e,t=[]){for(const r of e)t.push([]),fe(r,t);return t}(s)}function dt(e,t,r,n=-1){if(!e)return[0];n+=1;let s=0;const a=e.length>1,o=e.map((e=>{var o;const i=!e.enableGrouping&&n||null===(o=e.schema)||void 0===o||!o.computed?pt:se,[l,c]=i(e,t,r,n,a,dt);return s+=l,c}));return[s,o]}function pt(e,t,r,n,s,a){const{header:o}=t,i=o[n],{key:l,subItems:c,name:u,headerText:d=u,showTotal:p,showTotalFirst:m,...f}=e,h=_(e);if(n||(f.enableGrouping=!0),!f.enableGrouping){const e={key:l,headerText:d,...f,colGroup:!0,depth:n,tagProps:{},cellProps:h};return s?(i.push(e),[1,e]):[0,e]}const y=et(e.filter);y&&(r=y(r));const g=p&&{headerText:"Total",colGroup:!0,enableGrouping:!0,depth:n,tagProps:{}};let v=0;const x=[];g&&m&&(i.push(g),x.push(g),v=ft(g,t,c,n,r));const b=lt(e);let w=0;return b(r,((r,s,o)=>{const u={key:l,...f,colGroup:!0,depth:n,colGroupFn:b,groupFilterFn:B(o),issueFilterFn:O(e,o),value:r,...h,tagProps:{}};i.push(u);const[d,p]=a(c,t,s,n);d&&(u.tagProps.colSpan=d),p&&(u.subItems=p.flat()),w+=d,x.push(u)})),g&&!m&&(i.push(g),x.push(g),v=ft(g,t,c,n,r)),[w?w+v:x.length,x]}function mt(){const{fields:e}=T.getState();return ht({subItems:e.filter((e=>e.colGroup)),enableGrouping:!0})}function ft(e,t,r,n,s){const[a,o]=dt(r,t,s,n);return a&&(e.tagProps.colSpan=a),o&&(e.subItems=o.flat()),a||1}function ht(e,t,r=0,n=1){const{subItems:s,enableGrouping:a,schema:o={}}=e;if(o.computed&&o.depth?r+=o.depth:(a||t)&&(r+=1),null===s||void 0===s||!s.length)return n>r?n:r;const i=s.length>1,l=s.reduce(((e,t)=>ht(t,i,r,e)),r);return n>l?n:l}function yt(){const{jql:e,fields:t}=T.getState(),r=[];null!==e&&void 0!==e&&e.trim()||r.push("JQL is required to pull issues from Jira"),null!==t&&void 0!==t&&t.length||r.push("No fields selected to generate report");const{fieldsMap:n}=We.getState(),s={fieldsMap:n,fields:{},parameters:{}};if(t.forEach(((e,t)=>function(e,t,r,n,s){gt(e,t,r,n,s,e.colGroup)}(e,t,0,r,s))),!r.length)return s;S.setState({reportErrors:r,isFetching:!1},!0)}function gt(e,t,r,n,s,a,o=""){!function(e,t,r,n,s,a){const{name:o,filter:i}=e;if(null!==i&&void 0!==i&&i.trim()){const{isValid:e,errorMessage:r}=we(i,s);e||n.push(`Field ${a}"${o}" at position ${t+1} has error in filter query: (${r})`)}}(e,t,0,n,s,o),a?function(e,t,r,n,s=""){const{name:a,subItems:o,enableGrouping:i}=e,l=i||!r;l&&(null!==o&&void 0!==o&&o.length||n.push(`Grouping is enabled for field ${s}"${a}" at position ${t+1}, but do not contain row values. Drag and drop the field(s) to be shown as value under "${a}"`),null===o||void 0===o||o.forEach(((e,o)=>gt(e,o,r+1,n,!0,`${s}"${a}" (Position: ${t}) -> `))))}(e,t,r,n,o):function(e,t,r,n){const{id:s,name:a}=e;vt.includes(s)&&n.push(`Field "${a}" at position ${t+1} is currently not supported to be used as rows. Convert it to column group instead`)}(e,t,0,n)}const vt=["dateRange"];async function xt(){const e=yt();if(e&&function({parameters:e}){const{parameters:t={}}=T.getState(),{showParameters:r,parameters:n}=Object.values(e).reduce(((e,r)=>{const n=r.name.toLowerCase();let s=t[n];return s&&s.type===r.type&&s.isArray===r.isArray||(s={name:r.name,type:r.type,isArray:r.isArray}),s.value||(e.showParameters=!0),e.parameters[n]=s,e}),{showParameters:!1,parameters:{}});T.setState({parameters:n}),r&&S.setState({showParameters:!0},!0);return!r}(e)){S.setState({reportErrors:null,isFetching:!0});try{const t=await async function(e){const{jql:t,fields:r}=$(e.fields),{$jira:n}=(0,y.uU)("JiraService");return(await n.searchTickets(t,r)).map((({id:e,key:t,fields:r})=>function(e){return e.worklog&&(e.worklog=e.worklog.worklogs),e.comment&&(e.comment=e.comment.comments),e}({...r,id:e,issuekey:t})))}(e),r={header:new Array(mt()).fill(null).map((()=>[])),body:[],footer:[]};!function(e,t){const{fields:r}=T.getState(),n=e.header.length;let s;r.forEach((r=>{r.colGroup?dt([r],e,t):s=ct(r,s,e,n)}))}(r,t),ut(r,t),S.setState({reportData:r,isFetching:!1},!0)}catch(r){let e=["Unknown error occurred while generating report. Look at console log for more details"];var t;if(400===r.status)e=(null===(t=r.error)||void 0===t?void 0:t.errorMessages)||e;console.error("Error generating pivot report:- ",r),S.setState({reportErrors:e,isFetching:!1},!0)}}}async function bt(e){const{id:t}=e,{$report:r}=(0,y.uU)("ReportService"),n=await r.saveQuery(e,!0);return t!==n&&r.getReportDefinition(n)}var wt=r(576),jt=r(8192);const kt=function({title:e,onBackClick:t,show:r,onHide:n,children:s,contentClassName:a,controls:o}){return(0,v.jsx)("div",{className:"side-bar-container "+(r?"open":"closed"),children:(0,v.jsxs)("div",{className:"site-bar-block",children:[(0,v.jsxs)("div",{className:"header"+(t?" ps-0":""),children:[(0,v.jsx)(i.q,{className:"close-icon",icon:"fa fa-times",onClick:n,title:"Hide this block"}),o,t&&(0,v.jsx)(i.q,{className:"back-icon float-start",icon:"fa fa-arrow-left",onClick:t,title:"Configure data source"}),(0,v.jsx)("h2",{className:"title",children:e})]}),(0,v.jsx)("div",{className:d()("site-bar-content",a),children:s})]})})};const Nt=function(){const e=We((({fields:e})=>e));return s.useEffect((()=>{Je()}),[]),(0,v.jsxs)("div",{className:"fields-collection",children:[(0,v.jsx)(St,{}),(0,v.jsx)("div",{className:"fields-group-view",children:e.map((e=>(0,v.jsx)(Ct,{fields:e.items,title:e.label},e.label)))})]})};function St(){const{searchText:e,setSearchText:t}=C();return(0,v.jsxs)("div",{className:"search-container",children:[(0,v.jsx)("span",{className:"fa fa-search"}),(0,v.jsx)(i.SC,{value:e,placeholder:"type here to search for fields...",onChange:t})]})}function Ct({fields:e,title:t}){var r,n;const a=null===(r=C((({searchText:e})=>e)))||void 0===r||null===(n=r.trim())||void 0===n?void 0:n.toLowerCase(),[o,l]=s.useState((()=>Tt(e,a)));return s.useEffect((()=>{l(Tt(e,a))}),[a,e,l]),null!==o&&void 0!==o&&o.length?(0,v.jsxs)("div",{className:"fields-list",children:[(0,v.jsx)("div",{className:"block font-bold",children:t}),o.map(((e,t)=>(0,v.jsxs)(i.wf,{className:"jira-field",itemType:"jira-field",item:e,children:[(0,v.jsx)("span",{className:"fa fa-copy float-end pointer",onClick:t=>function(e,t){var r;(0,k.EV)(e);let n=t.custom?t.name:t.key;n.includes(" ")&&(n=`\`${n}\``);null!==(r=navigator.clipboard)&&void 0!==r&&r.writeText&&navigator.clipboard.writeText(n)}(t,e),title:"Click to copy field for query filter"}),(0,v.jsx)("span",{children:e.name})]},t)))]}):null}function Tt(e,t){if(!t)return e;return e.filter((e=>e.name.toLowerCase().includes(t)||e.key.toLowerCase().includes(t)))}function Ft({item:e},{index:t}){const r=R(e);T.setState((({fields:e})=>((e=[...e]).splice(t,0,r),{fields:e})))}function At(e){T.setState((({fields:t})=>((t=[...t]).splice(e,1),{fields:t}))),F.setState({itemPath:null})}function Et(e,t){T.setState((({fields:r})=>((r=[...r])[t]=e,{fields:r})))}function Pt(e){T.setState({fields:e})}const It=function({item:e,index:t,depth:r,dragProps:n}){const a=s.useCallback((e=>{(0,k.EV)(e),At(t)}),[t]),{itemPath:o,selectItem:i}=F(),l=s.useCallback((()=>i(`fields.${t}`,r)),[t,r,i]);return(0,v.jsx)("div",{className:"row-item"+(o?" selected":""),onClick:l,children:(0,v.jsxs)("div",{className:"row-config-head",ref:n.dragRef,children:[(0,v.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:a}),(0,v.jsx)("span",{className:"icon fa-solid fa-up-down-left-right"}),e.displayText||e.name]})})},Rt=["jira-field"],$t=[];function Gt(e){return{...e,subItems:[...e.subItems||[]]}}function qt({path:e,item:t,depth:r,index:n,dragProps:a,removeItem:l,updateItem:c}){const u=s.useRef();s.useEffect((()=>{u.current={index:n,item:t,updateItem:c}}),[n,t,c]);const[p,m]=(0,o.c)(!0),f=s.useCallback((({itemType:e,item:t},{index:r})=>{"jira-field"===e&&(t=R(t));const{item:n,index:s,updateItem:a}=u.current,o=Gt(n);o.subItems.splice(r,0,t),a(o,s)}),[]),h=s.useCallback((e=>{const{item:t,index:r,updateItem:n}=u.current,s=Gt(t);s.subItems.splice(e,1),n(s,r)}),[]),y=s.useCallback((()=>l(u.current.index)),[l]),g=s.useCallback(((e,t)=>{const{item:r,index:n,updateItem:s}=u.current,a=Gt(r);a.subItems[t]=e,s(a,n)}),[]),x=s.useCallback((e=>{const{item:t,index:r,updateItem:n}=u.current;n({...t,subItems:e},r)}),[]),{itemPath:b,selectItem:w}=F(),j=s.useCallback((t=>{(0,k.EV)(t),w(e,r)}),[e,r,w]),N=0===r||t.enableGrouping,S=d()("icon-col fa",{pointer:N,"fa-angle-down":N&&p,"fa-angle-right":N&&!p,"fa-arrow-right":!N});return(0,v.jsxs)("div",{className:"col-item"+(b===e?" selected":""),onClick:j,children:[(0,v.jsxs)("div",{className:"col-config-head",ref:a.dragRef,children:[(0,v.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:y}),N&&(0,v.jsx)("span",{className:"icon-pivot float-end fa-solid fa-table-columns me-2",title:"This field would be pivoted as column"}),(0,v.jsx)("span",{className:S,onClick:m}),t.displayText||t.name]}),p&&N&&(0,v.jsx)(i.T2,{addPlaceholder:!0,className:"sub-items",useDragRef:!0,items:t.subItems||$t,accept:Rt,defaultItemType:"col-sub-group",onDrop:f,onChange:x,placeholder:`Drag and drop sub group or value field for ${t.name}`,children:(t,n,{draggable:s})=>(0,v.jsx)(qt,{path:`${e}.subItems.${n}`,index:n,depth:r+1,item:t,dragProps:s,removeItem:h,updateItem:g},n)})]})}const Lt=function({...e}){return(0,v.jsx)(qt,{...e,removeItem:At,updateItem:Et})};const Dt=function(){return(0,v.jsx)("div",{className:"pivot-config",children:(0,v.jsx)(Ut,{})})},Mt=["jira-field"],_t=(0,v.jsx)("span",{className:"p-3 block",children:"Drag and drop required fields from list to be shown in report"});function Ut(){const e=T((({fields:e})=>e));return(0,v.jsxs)("div",{className:"fields-config",children:[(0,v.jsx)("strong",{children:"Report Fields"}),(0,v.jsx)(i.T2,{placeholder:_t,useDragRef:!0,items:e,accept:Mt,defaultItemType:"row-group",onDrop:Ft,onChange:Pt,children:(e,t,{draggable:r})=>e.colGroup?(0,v.jsx)(Lt,{item:e,index:t,dragProps:r,depth:0,path:`fields.${t}`},t):(0,v.jsx)(It,{index:t,item:e,depth:0,dragProps:r},t)})]})}var Ot=r(7968);const Bt=[{value:"days",label:"Days with Week"},{value:"week",label:"Week with Month"}];const Vt=function({isRow:e}){const t=We((({fields:e})=>e)),r=s.useMemo((()=>t.map((({label:e,items:t})=>({label:e,items:t.filter((e=>{var t,r,n;return(null===(t=e.schema)||void 0===t||null===(r=t.type)||void 0===r?void 0:r.startsWith("date"))&&"date-range"!==(null===(n=e.schema)||void 0===n?void 0:n.type)}))})))),[t]);return(0,v.jsxs)("div",{className:"display-options",children:[(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Date Range:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Ot.q_,{field:"dateRange",range:!0})})]}),!e&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Range Type:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Ot.ic,{field:"rangeType",dataset:Bt,autoSelect:!0})})]}),(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Filter issues with:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Ot.ic,{field:"filterField",dataset:r,valueField:"key",optionLabel:"name",optionGroupLabel:"label",optionGroupChildren:"items",filter:!0,grouped:!0})})]})]})},Ht={any:function({item:e,isGrouped:t,isRow:r}){var n,s;const a=!t&&function(e,t){return Q.filter((r=>(!r.allowedFor||r.allowedFor.includes(e))&&(t||r.value!==H)))}(null===(n=e.schema)||void 0===n?void 0:n.type,r),o=!t&&((i=e.agrFunc)&&W.includes(i));var i;const l=M[(null===(s=e.schema)||void 0===s?void 0:s.type)||""];return(0,v.jsxs)("div",{className:"display-options",children:[a&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Function:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Ot.ic,{field:"agrFunc",dataset:a,autoSelect:!0})})]}),o&&(0,v.jsx)("div",{className:"label-value-pair",children:(0,v.jsx)(Ot.wN,{field:"useDistinct",label:"Use distinct values only",disabled:!0})}),l&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Formatting:"}),(0,v.jsx)("span",{className:"prop-value",children:(0,v.jsx)(Ot.ic,{field:"format",dataset:l,autoSelect:!0})})]})]})},"date-range":Vt};const Qt=function({filterText:e}){return(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Filter Query:"}),(0,v.jsx)(Ot.uu,{className:"w-100",field:"filter",multiline:!0}),(0,v.jsx)(Wt,{filterText:e})]})};function Wt({filterText:e}){const[t,r]=s.useState({}),n=We((e=>e.fieldsMap)),a=s.useRef(n);return a.current=n,s.useEffect((()=>{if(null!==e&&void 0!==e&&e.trim()){const t={fieldsMap:a.current,fields:{},parameters:{}};r(we(e,t))}else r({})}),[e,r]),t.isValid?null:(0,v.jsx)("div",{className:"msg-error",children:t.errorMessage})}const Jt=function({selection:e}){var t;const{itemPath:r,item:n,isRow:a,level:o,selectItem:l}=e,c=s.useCallback((()=>l()),[l]);if(!n)return null;const u=n.enableGrouping||!a&&0===o,d=Ht[null===(t=n.schema)||void 0===t?void 0:t.type]||Ht.any;return(0,v.jsxs)("div",{className:"item-properties",children:[(0,v.jsx)(i.q,{icon:"fa fa-times",className:"float-end",onClick:c}),(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Field name:"}),(0,v.jsx)("span",{className:"prop-value",children:n.name})]}),(0,v.jsx)(Ot.QF,{value:n,onChange:A,args:{itemPath:r,isRow:a},children:(0,v.jsxs)("div",{className:"config-props",children:[!o&&(0,v.jsx)(Ot.wN,{field:"colGroup",label:"Make this a column group field"}),(a||!!o)&&(0,v.jsx)(Ot.wN,{label:"Enable grouping",field:"enableGrouping"}),(a||!u)&&(0,v.jsxs)("div",{className:"label-value-pair",children:[(0,v.jsx)("label",{children:"Header text"})," ",(0,v.jsx)(Ot.uu,{field:"headerText",maxLength:35,placeholder:n.name||"Custom header text for column"})]}),u&&(0,v.jsx)(Ot.wN,{className:"inline-block",label:"Show totals",field:"showTotal"}),u&&(0,v.jsx)(Ot.a7,{className:"inline-block btn-sm float-end",onLabel:"At start",offLabel:"At end",field:"showTotalFirst",disabled:!n.showTotal}),d&&(0,v.jsx)(d,{item:n,isGrouped:u,isRow:a}),u&&(0,v.jsx)(Qt,{filterText:n.filter})]})})]})};var zt=r(8767),Kt=r(5960),Yt=r(8724);const Xt=function({reportId:e}){const t=(0,a.i6)(),[r,n]=(0,o.c)(!1),l=s.useCallback((async()=>{e?await function(){const{hasChanges:e,...t}=T.getState();return bt(t)}():n()}),[e,n]),c=s.useCallback((()=>{!function(e){const{id:t,queryName:r,createdBy:n}=T.getState();Yt.c.confirmDelete(`Are you sure to delete the report named "${r}" permanently?`).then((()=>{const{$report:s,$message:a,$analytics:o}=(0,y.uU)("ReportService","MessageService","AnalyticsService");s.deleteSavedQuery(t).then((t=>{a.success(`Pivot report "${r}" deleted successfully`),o.trackEvent("Pivot Report Deleted"),e(n)}))}))}((e=>{t(`/${e}/reports/pivot`)}))}),[t]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"controls float-end",children:[!!e&&(0,v.jsx)(i.q,{icon:"fa fa-trash",className:"mx-1",severity:"danger",onClick:c,title:"Delete this report"}),(0,v.jsx)(i.q,{icon:"fa fa-save",className:"mx-1",onClick:l,title:"Save this report"}),!!e&&(0,v.jsx)(i.q,{icon:"fa fa-copy",className:"mx-1",onClick:n,title:"Rename report or save as new report"})]}),r&&(0,v.jsx)(Kt.c,{allowCopy:!!e,onHide:n,onChange:async(e,r)=>{const s=await function(e,t){const{hasChanges:r,...n}=T.getState();return n.queryName=e,t&&delete n.id,bt(n)}(e,r);if(n(),s){const{id:e,createdBy:r}=s;t(`/${r}/reports/pivot/${e}`)}}})]})};const Zt=function({show:e,onHide:t,reportId:r}){const[n,s]=(0,o.c)(!r),a=(0,v.jsx)(Xt,{reportId:r,onToggleDataSource:s});return(0,v.jsx)(kt,{show:e,onHide:t,title:"Report Config",onBackClick:n?void 0:s,controls:a,width:"500",contentClassName:"p-0",children:(0,v.jsx)("div",{className:"editor-controls",children:n?(0,v.jsx)(er,{onDone:s}):(0,v.jsx)(tr,{})})})};function er({onDone:e}){const{jql:t,dataSourceType:r}=T((({jql:e,dataSourceType:t})=>({jql:e,dataSourceType:t})));return(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("p",{children:"Select a data source option for retrieving a list of issues. You have the choice of utilizing direct Jira Query Language (JQL) queries or extracting a list of issues based on a specific sprint and subsequently applying a JQL filter to refine the results."}),(0,v.jsx)("label",{className:"font-bold mt-3",children:"Data source type:"}),(0,v.jsx)(jt.OU,{className:"block",value:r,defaultValue:1,label:"Use raw JQL to filter and pull issues list",onChange:I}),(0,v.jsx)(jt.OU,{className:"block",value:r,defaultValue:2,label:"Pull issues for select sprints and apply JQL filter",onChange:I,disabled:!0}),(0,v.jsx)("label",{className:"font-bold mt-3",children:"JQL Query:"}),(0,v.jsx)(zt.c,{jql:t,plugged:!0,onChange:P}),(0,v.jsx)(i.q,{className:"float-end me-2",icon:"fa fa-arrow-right",iconPos:"right",label:"Select fields",disabled:2!==r&&(null===t||void 0===t?void 0:t.length)<5,onClick:e,title:"Configure data source"})]})}function tr(){const e=function(){const{itemPath:e,level:t,selectItem:r}=F(),n=T((t=>e?(0,k.qu)(t,e):null));if(!n)return{};const s=!n.colGroup&&!t;return{item:n,itemPath:e,isRow:s,level:t,selectItem:r}}(),t=!(null===e||void 0===e||!e.item);let r=(0,v.jsxs)("div",{className:"field-config",children:[(0,v.jsx)(Dt,{}),(0,v.jsx)(Nt,{})]});return t&&(r=(0,v.jsxs)(wt.S,{style:{height:"100%"},layout:"vertical",children:[(0,v.jsx)(wt.k,{style:{height:"10%"},children:r}),(0,v.jsx)(wt.k,{style:{height:"5%"},children:(0,v.jsx)(Jt,{selection:e})})]})),(0,v.jsx)("div",{className:"controls",children:r})}var rr=r(3712);const nr=function(){const e=T((({queryName:e})=>e)),t=S((({reportData:e})=>e));return(0,v.jsx)("div",{className:"group-table-container",children:(0,v.jsxs)(rr._e,{className:"group-table table-bordered",exportSheetName:e,children:[(0,v.jsx)(sr,{rows:t.header,tag:rr.mE,isHeader:!0}),(0,v.jsx)(sr,{rows:t.body,tag:rr.gP})]})})};function sr({tag:e,isHeader:t,rows:r}){return(0,v.jsx)(e,{children:r.map(((e,r)=>(0,v.jsx)(ar,{isHeader:t,cells:e},r)))})}function ar({isHeader:e,cells:t}){return(0,v.jsx)("tr",{children:t.map(((t,r)=>(0,v.jsx)(or,{isHeader:e,cell:t},r)))})}function or({isHeader:e,cell:t}){const r=e?"th":"td",{value:n,headerText:s,tagProps:a,renderer:{Component:o,props:i}={}}=t;if(o)return(0,v.jsx)(o,{...i,value:n,tag:r,tagProps:a});{const t=(e?s:n)||" ";return(0,v.jsx)(r,{...a,children:t})}}var ir=r(9288);const lr=function(){return(0,v.jsx)("div",{className:"pad-15",children:(0,v.jsxs)("section",{children:[(0,v.jsx)("h2",{children:"How to Use the Pivot Report"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"Start by providing a JQL query to filter data from Jira."}),(0,v.jsx)("li",{children:"Easily customize your report by dragging and dropping fields from the right corner into the Report Fields section."}),(0,v.jsx)("li",{children:"You have the flexibility to display data as regular rows with grouping or mark specific fields as column groups for a column-based layout."}),(0,v.jsx)("li",{children:"Utilize Column Groups to organize and present your data in columns, offering a structured view of your information."}),(0,v.jsx)("li",{children:"Make use of subgroups and filters within column groups to further refine your report's content."}),(0,v.jsx)("li",{children:"To preview your report, simply click on the preview icon located at the top of the report interface."})]}),(0,v.jsxs)("p",{children:["To know more about Pivot report, have a look at ",(0,v.jsx)(i.cH,{href:`${ir.yR}/features/reports/pivot`,children:"documentation"})]}),(0,v.jsxs)("p",{children:["To report a bug or suggest improvements to the report, visit ",(0,v.jsx)(i.cH,{href:`${ir.IN}/discussions/329`,children:"GitHub discussions"})]}),(0,v.jsx)("h2",{children:"Upcoming Enhancements"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"The ability to sort the data under each group."}),(0,v.jsx)("li",{children:"The ability to display totals for each group, offering a more comprehensive view of your data."}),(0,v.jsx)("li",{children:"Support for utilizing parent, sub-tasks and linked issues, allowing you to explore relationships and dependencies within your data."}),(0,v.jsx)("li",{children:"Enhanced support for pulling issues based on sprints, in addition to JQL queries, for a more dynamic reporting experience."})]}),(0,v.jsx)("h2",{children:"Future Enhancements"}),(0,v.jsxs)("ul",{children:[(0,v.jsx)("li",{children:"Enhanced support for adding the Pivot Report as a gadget on your dashboard, providing seamless integration with your Jira workflow."}),(0,v.jsx)("li",{children:"Exciting new features, including the option to add chart views based on your data, enabling richer data visualization."})]}),(0,v.jsx)("br",{}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:"Please Note:"})," This report is currently undergoing development and is not yet considered fully operational. We strongly request you to manually validate the output before using it for any business purpose. If you encounter any unexpected errors or if the output does not align with your expectations, we kindly request that you report the issue to us. Your assistance in improving the report's reliability is greatly appreciated."]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("strong",{children:"When reporting issues"}),", we kindly ask you to provide the following details:"]}),(0,v.jsxs)("ol",{children:[(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Screenshots:"})," Include screenshots that illustrate the problem or discrepancies you've encountered. Visual aids can significantly assist us in identifying issues."]}),(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Console Error Logs:"})," If applicable, please provide any error messages or console logs related to the problem. These logs can offer valuable insights into the root cause of the issue."]}),(0,v.jsxs)("li",{children:[(0,v.jsx)("strong",{children:"Custom Fields:"})," If the issue pertains to specific custom fields, please specify the type of custom fields involved. This information can help us pinpoint and address field-specific challenges more effectively."]})]}),(0,v.jsx)("p",{children:"Your feedback and collaboration are instrumental in ensuring the quality and reliability of this report. We appreciate your patience and assistance as we work to enhance its performance."})]})]})})};const cr=function(){const{hasReportData:e,reportErrors:t,isFetching:r,showParameters:n}=S((({reportData:e,reportErrors:t,isFetching:r,showParameters:n})=>({hasReportData:!!e,reportErrors:t,isFetching:r,showParameters:n})));return r?(0,v.jsx)("div",{className:"editor-body p-4",children:(0,v.jsx)("strong",{children:"Please wait while the data is being pulled from Jira. This may take a while depending on the number of issues being pulled."})}):(0,v.jsxs)("div",{className:"editor-body",children:[t&&(0,v.jsx)(ur,{errors:t}),n&&(0,v.jsx)(dr,{}),e&&(0,v.jsx)(nr,{}),!e&&!n&&(0,v.jsx)(lr,{})]})};function ur({errors:e}){return(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("h2",{children:"Report Definition Error"}),(0,v.jsx)("p",{children:"The report definition has one or more errors. Please fix it before you try to generate report"}),(0,v.jsx)("ul",{className:"msg-error",children:e.map(((e,t)=>(0,v.jsx)("li",{children:e},t)))})]})}function dr(){const e=T((({parameters:e})=>e)),t=Object.keys(e);return(0,v.jsx)(Ot.QF,{value:e,onChange:E,children:(0,v.jsxs)("div",{className:"p-3",children:[(0,v.jsx)("strong",{children:"Provide values for missing parameters to generate report:"}),(0,v.jsx)("br",{}),t.map((t=>(0,v.jsxs)("div",{className:"param-field py-3",children:[(0,v.jsxs)("label",{className:"font-bold me-3",children:[e[t].name,": "]}),(0,v.jsx)(pr,{...e[t]})]},t))),(0,v.jsx)("br",{}),(0,v.jsx)(jt.q,{icon:"fa fa-refresh",label:"Generate Report",onClick:xt})]})})}function pr({type:e,isArray:t,name:r}){const n=`${r.toLowerCase()}.value`;switch(e){default:return t?(0,v.jsx)(Ot.c$,{field:n,clearIfEmpty:!0}):(0,v.jsx)(Ot.uu,{field:n});case"daterange":return(0,v.jsx)(Ot.q_,{field:n,range:!0});case"datetime":return(0,v.jsx)(Ot.q_,{field:n,showTime:!0});case"date":return(0,v.jsx)(Ot.q_,{field:n,showTime:!1});case"usergroup":return(0,v.jsx)("span",{className:"link",children:"Select users"})}}const mr=function({reportId:e,reportType:t,reportPath:r}){const[n,o]=s.useState(),l=(0,a.i6)();s.useEffect((()=>{(async function(e){const{$report:t}=(0,y.uU)("ReportService"),r=(await t.getReportsList()).filter((t=>t.reportType===e)).map((e=>({value:e.id,label:e.queryName})));return r})(t).then(o)}),[t]);const c=s.useCallback((e=>{e&&l(`${r}/${e}`)}),[l,r]);return null!==n&&void 0!==n&&n.length?(0,v.jsx)(i._U,{className:"report-picker",dataset:n,value:parseInt(e),valueField:"value",onChange:c,placeholder:"Select a report to edit"}):null};const fr=function(){const{reportId:e,userId:t}=(0,a.W4)(),[r,n]=(0,o.c)(!e);s.useEffect((()=>{!async function(e){if(!e)return T.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),void S.setState({},!0);const{$report:t}=(0,y.uU)("ReportService"),r=await t.getReportDefinition(e),{$message:n}=(0,y.uU)("MessageService");r?"pivot"!==r.reportType?(T.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report "${r.queryName}" is not a valid Pivot Report.`,"Report Incompatible")):T.setState(r,!0):(T.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report id "${e}" is invalid or the report has been deleted.`,"Report Not Found"))}(e)}),[e]);const l=S((({isFetching:e})=>e)),{queryName:c,parameters:u}=T((({queryName:e,parameters:t})=>({queryName:e,parameters:t}))),d=u&&Object.keys(u).length>0,p=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(mr,{reportType:"pivot",reportId:e,reportPath:`/${t}/reports/pivot`}),d&&(0,v.jsx)(i.q,{type:"secondary",icon:"fa fa-list-check",className:"mx-1",onClick:hr,title:"Show report parameters"}),(0,v.jsx)(i.q,{type:"secondary",icon:"fa fa-edit",className:"mx-1",onClick:n,title:"Edit report definition"})]});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Zt,{reportId:e,show:r,onHide:n}),(0,v.jsx)("div",{className:"page-container",children:(0,v.jsx)(x,{title:c?`${c} - [Pivot report]`:"Pivot report",isGadget:!1,isLoading:l,customActions:p,onRefresh:xt,children:(0,v.jsx)(cr,{})})})]})};function hr(){S.setState((({showParameters:e})=>({showParameters:!e})))}}}]);